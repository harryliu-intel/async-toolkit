* tech comparison
.TEMP @TEMP@
.PARAM vtrue=@VDD@

.OPTION CMIFLAG=1 CMIUSRFLAG=3 PDMI=1
.option cmipath='/p/hdk/cad/pdk/pdk783_r0.9_23ww26.5_alpha/cmi/hspice/cmi/lnx86/64bit'
.option cmi02opt=1
.OPTION POST=fsdb PROBE=1
.OPTION XA_CMD="set_sim_level -level 6"
.OPTION XA_CMD="set_wildcard_rule -match* one"
.OPTION XA_CMD="set_message_option -limit 100"
.OPTION XA_CMD="enable_print_statement 1"
.OPTION XA_CMD="set_sim_case -case sensitive"
.option redefsub

* Monte Carlo stuff

.OPTION XA_CMD="set_monte_carlo_option -enable 1"     
.OPTION XA_CMD="set_monte_carlo_option -sample_output all"
.OPTION XA_CMD="set_monte_carlo_option -mc0_file 1"
.OPTION XA_CMD="set_monte_carlo_option -parameter_file 1"
.OPTION XA_CMD="set_monte_carlo_option -mc0_header 1"
.OPTION XA_CMD="set_monte_carlo_option -dump_waveform 1"

.option autostop

.option search='@HSP_DIR@'
.lib 'p1278_3.hsp' tttt

.option PDMI=1
.option PDMI_LIB='/p/hdk/cad/pdk/pdk783_r0.5_22ww52.5//cmi/hspice/pdmi/lnx86/64bit/pdmi.so'



**********************************************************************
*
* random data generator
*
* The following circuit, under variation, will generate random, static outputs.
*
*



* Probes (for debugging)

.PROBE TRAN v(clk)
.PROBE TRAN i(Vvcc)
.PROBE TRAN v(_RESET)
.PROBE TRAN v(vcc)
.PROBE TRAN v(vload)
.PROBE TRAN v(vssx)
.PROBE TRAN v(vissx)
.PROBE TRAN v(vissy)
.PROBE TRAN i1(Vvssx)
.probe tran v(out)

* Sources
.PARAM step=@STEP@
.PARAM rise=@RISE@


Vres _RESET   0 DC=0 PWL 0 0 '1*step-0.5*rise' 0 '1*step+0.5*rise' vtrue

Vvcc    vcc   0 DC=vtrue
Vvcc1   vcc1  0 DC=vtrue * not counted for power
Vvload  vload 0 DC=vtrue
Vvssx   vssx  0 DC=0


*.include "include.sp"

.include "the_scaled_dut.sp"

* Simulate
.TRAN 1ps 10us sweep monte=@SWEEPS@


* Measure

Xdut _RESET out vcc vssx the_oscillator

.measure tran IdleCurrent   avg i(Vvcc) from '0.5*step' to 'step-0.5*rise'
.measure tran IdlePower     PARAM='(-IdleCurrent*vtrue)'

.param measure_cycles=4
.param skip_cycles=2

.measure tran Cycle
+ trig V(out) val='vtrue*0.5' td='step' rise='skip_cycles'
+ targ V(out) val='vtrue*0.5' td='step' rise='skip_cycles+measure_cycles'

.END
