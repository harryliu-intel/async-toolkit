// Autogenerated Jamon implementation
// C:/Users/mhesseli/Documents/Perforce/rrc-5/reg-main/shared/java/src/./com/fulcrummicro/hw/verification/chip/mgmt/registers/templates/VfUL.jamon

package com.fulcrummicro.hw.verification.chip.mgmt.registers.templates;

// 8, 1
import java.util.Collection;
// 9, 1
import java.util.Iterator;
// 10, 1
import com.fulcrummicro.util.misc.Utility;
// 11, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.Register;
// 12, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.RegisterBase;
// 13, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.RegisterField;
// 14, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnum;
// 15, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnumValue;

public class VfULImpl
  extends com.fulcrummicro.util.jamon.timestampImpl
  implements com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.VfUL.Intf

{
  private final String output;
  private final Collection<RegisterBase> bases;
  private final Collection<Register> regs;
  private final String prefix;
  private final int addrBits;
  // 254, 1
  
static int ndims(Register r) {
    return r.getNumDimensions() == 1 && r.getNumEntries() == 1 ?
           0 :
           r.getNumDimensions();
}
static int __DECL_DEFAULT_WIDTH = 70;
static int __DECL_ENUM_WIDTH = 60;
static int __DECL_BASE_WIDTH = 40;

  protected static com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.VfUL.ImplData __jamon_setOptionalArguments(com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.VfUL.ImplData p_implData)
  {
    if(! p_implData.getAddrBits__IsNotDefault())
    {
      p_implData.setAddrBits(24);
    }
    com.fulcrummicro.util.jamon.timestampImpl.__jamon_setOptionalArguments(p_implData);
    return p_implData;
  }
  public VfULImpl(org.jamon.TemplateManager p_templateManager, com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.VfUL.ImplData p_implData)
  {
    super(p_templateManager, __jamon_setOptionalArguments(p_implData));
    output = p_implData.getOutput();
    bases = p_implData.getBases();
    regs = p_implData.getRegs();
    prefix = p_implData.getPrefix();
    addrBits = p_implData.getAddrBits();
  }
  
  @Override protected void child_render_1(final java.io.Writer jamonWriter)
    throws java.io.IOException
  {
    // 264, 1
    
String guard = "__".concat(prefix).concat(output).replaceAll("\\.", "_").toUpperCase();
String pakkage = prefix.concat("registers_pkg").toLowerCase();

    // 268, 1
    jamonWriter.write("/**\n * INTEL TOP SECRET\n * Copyright ");
    // 270, 14
    {
      // 270, 14
      __jamon_innerUnit__copyright_year(jamonWriter, 2013 );
    }
    // 270, 55
    jamonWriter.write(" Intel Corporation\n * All Rights Reserved.\n *\n * THIS FILE IS AUTOMATICALLY GENERATED - DO NOT MODIFY.\n * Last Updated ");
    // 274, 17
    {
      // 274, 17
      __jamon_innerUnit__timestamp(jamonWriter);
    }
    // 274, 33
    jamonWriter.write("\n */\n\n`ifndef ");
    // 277, 9
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(guard), jamonWriter);
    // 277, 20
    jamonWriter.write("\n`define ");
    // 278, 9
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(guard), jamonWriter);
    // 278, 20
    jamonWriter.write("\n\npackage ");
    // 280, 9
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(pakkage), jamonWriter);
    // 280, 22
    jamonWriter.write(";\n\n/******************************************************************************\n * Utility Parameters & Macros\n ******************************************************************************/\n\n");
    // 286, 1
    {
      // 286, 1
      __jamon_innerUnit____decl(jamonWriter, "ADDR_BITS", null, "localparam", __DECL_BASE_WIDTH );
    }
    // 286, 80
    jamonWriter.write(" = ");
    // 287, 1
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(addrBits), jamonWriter);
    // 287, 15
    jamonWriter.write(";\n\n`define ");
    // 289, 9
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix.toUpperCase()), jamonWriter);
    // 289, 35
    jamonWriter.write("GET_BIT(rvalue, csr, field)                 \\\n    rvalue[csr``_b_``field]\n`define ");
    // 292, 9
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix.toUpperCase()), jamonWriter);
    // 292, 35
    jamonWriter.write("GET_FIELD(rvalue, csr, field)               \\\n    rvalue[csr``_h_``field:csr``_l_``field]\n`define ");
    // 295, 9
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix.toUpperCase()), jamonWriter);
    // 295, 35
    jamonWriter.write("SET_BIT(lvalue, csr, field, rvalue)         \\\n    lvalue[csr``_b_``field] = rvalue\n`define ");
    // 298, 9
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix.toUpperCase()), jamonWriter);
    // 298, 35
    jamonWriter.write("SET_FIELD(lvalue, csr, field, rvalue)       \\\n    lvalue[csr``_h_``field:csr``_l_``field] = rvalue\n\n/******************************************************************************\n * Register Base Parameters, Macros & Types\n ******************************************************************************/\n\n");
    // 306, 1
    for (RegisterBase b : bases )
    {
      // 307, 1
      RegisterBase parent = b.getParent();
      // 308, 1
      {
        // 308, 1
        __jamon_innerUnit____decl(jamonWriter, b.getFullName(), null, "localparam", __DECL_BASE_WIDTH );
      }
      // 308, 84
      jamonWriter.write(" = ");
      // 309, 1
      {
        // 309, 1
        __jamon_innerUnit____strfaddr(jamonWriter, b.getIncrementalAddress() );
      }
      // 310, 1
      if (parent.getParent() != null )
      {
        // 310, 35
        jamonWriter.write("+ ");
        // 310, 37
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix.concat(parent.getFullName()).toUpperCase()), jamonWriter);
      }
      // 310, 98
      jamonWriter.write(";\n");
      // 312, 1
      
int w = Integer.MIN_VALUE;
for (Register r : b.getRegisters()) {
    w = Math.max(w, r.getEntryWidth());
}

      // 318, 1
      {
        // 318, 1
        __jamon_innerUnit____decl(jamonWriter, b.getName().toUpperCase(), "_MAX_WIDTH", "localparam", __DECL_BASE_WIDTH );
      }
      // 318, 117
      jamonWriter.write(" = ");
      // 319, 1
      {
        // 319, 1
        __jamon_innerUnit____xdisplay(jamonWriter, w, 32 );
      }
      // 319, 32
      jamonWriter.write(";\n\n");
      // 321, 1
      for (ConstantsEnum e : b.getEnums() )
      {
        // 322, 1
        {
          // 322, 1
          __jamon_innerUnit____enum(jamonWriter, e );
        }
        // 322, 20
        jamonWriter.write("\n");
      }
    }
    // 324, 8
    jamonWriter.write("\n/******************************************************************************\n * Register Parameters & Macros\n ******************************************************************************/\n\n");
    // 330, 1
    for (Register r : regs )
    {
      // 331, 1
      
int nDims = ndims(r);
boolean w = r.getEntryWidth() > 1;

      // 336, 1
      {
        // 336, 1
        __jamon_innerUnit____decl(jamonWriter, r.getName(), "_DEFAULT" , "localparam", __DECL_DEFAULT_WIDTH);
      }
      // 336, 78
      jamonWriter.write(" = ");
      // 337, 1
      {
        // 337, 1
        __jamon_innerUnit____xdisplay(jamonWriter, r.getDefault(0), r.getNumberFieldBits() );
      }
      // 337, 66
      jamonWriter.write(";\n");
      // 339, 1
      {
        // 339, 1
        __jamon_innerUnit____decl(jamonWriter, r.getName(), "_WIDTH" , "localparam", __DECL_DEFAULT_WIDTH);
      }
      // 339, 76
      jamonWriter.write(" = ");
      // 340, 1
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getEntryWidth()), jamonWriter);
      // 340, 24
      jamonWriter.write(";\n");
      // 342, 1
      if (nDims == 0 )
      {
        // 343, 1
        {
          // 343, 1
          __jamon_innerUnit____decl(jamonWriter, r.getName(), w ? "(word)" : "()" , "`define", __DECL_DEFAULT_WIDTH);
        }
        // 343, 84
        jamonWriter.write(" (");
      }
      // 344, 1
      else if (nDims == 1 )
      {
        // 345, 1
        {
          // 345, 1
          __jamon_innerUnit____decl(jamonWriter, r.getName(), w ? "(index, word)" : "(index)" , "`define", __DECL_DEFAULT_WIDTH);
        }
        // 345, 96
        jamonWriter.write(" ((");
        // 346, 2
        {
          // 346, 2
          __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace() );
        }
        // 346, 44
        jamonWriter.write(") * ((index) - ");
        // 346, 59
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry()), jamonWriter);
        // 346, 81
        jamonWriter.write(") + ");
      }
      // 347, 1
      else if (nDims == 2 )
      {
        // 348, 1
        {
          // 348, 1
          __jamon_innerUnit____decl(jamonWriter, r.getName(), w ? "(index1, index0, word)" : "(index1, index0)" , "`define", __DECL_DEFAULT_WIDTH);
        }
        // 348, 114
        jamonWriter.write(" ((");
        // 349, 2
        {
          // 349, 2
          __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace1() );
        }
        // 349, 45
        jamonWriter.write(") * ((index1) - ");
        // 349, 61
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry1()), jamonWriter);
        // 349, 84
        jamonWriter.write(") + (");
        // 350, 2
        {
          // 350, 2
          __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace() );
        }
        // 350, 44
        jamonWriter.write(") * ((index0) - ");
        // 350, 60
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry()), jamonWriter);
        // 350, 82
        jamonWriter.write(") + ");
      }
      // 351, 1
      else if (nDims == 3 )
      {
        // 352, 1
        {
          // 352, 1
          __jamon_innerUnit____decl(jamonWriter, r.getName(), w ? "(index2, index1, index0, word)" : "(index2, index1, index0)" , "`define", __DECL_DEFAULT_WIDTH);
        }
        // 352, 130
        jamonWriter.write(" ((");
        // 353, 2
        {
          // 353, 2
          __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace2() );
        }
        // 353, 45
        jamonWriter.write(") * ((index2) - ");
        // 353, 61
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry2()), jamonWriter);
        // 353, 84
        jamonWriter.write(") + (");
        // 354, 2
        {
          // 354, 2
          __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace1() );
        }
        // 354, 45
        jamonWriter.write(") * ((index1) - ");
        // 354, 61
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry1()), jamonWriter);
        // 354, 84
        jamonWriter.write(") + (");
        // 355, 2
        {
          // 355, 2
          __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace() );
        }
        // 355, 44
        jamonWriter.write(") * ((index0) - ");
        // 355, 60
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry()), jamonWriter);
        // 355, 82
        jamonWriter.write(") + ");
      }
      // 356, 1
      else
      {
        // 357, 1
        throw new Error(nDims + "-dimensional registers not supported");
      }
      // 359, 1
      if (w )
      {
        // 359, 10
        jamonWriter.write("(word) + ");
      }
      // 359, 25
      jamonWriter.write("(");
      // 360, 2
      {
        // 360, 2
        __jamon_innerUnit____strfaddr(jamonWriter, r.getAddressOffset() );
      }
      // 360, 47
      jamonWriter.write(") + (");
      // 361, 2
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix.toUpperCase() + r.getBaseName()), jamonWriter);
      // 361, 46
      jamonWriter.write("))\n\n");
    }
    // 363, 8
    jamonWriter.write("\n/******************************************************************************\n * Register Field Parameters\n ******************************************************************************/\n\n");
    // 369, 1
    for (Register r : regs )
    {
      // 370, 1
      {
        // 370, 1
        __jamon_innerUnit____regflds(jamonWriter, r );
      }
      // 370, 23
      jamonWriter.write("\n");
    }
    // 371, 8
    jamonWriter.write("\n/******************************************************************************\n * Register Types & Functions\n ******************************************************************************/\n\n");
    // 377, 1
    for (Register r : regs )
    {
      // 378, 1
      {
        // 378, 1
        __jamon_innerUnit____struct(jamonWriter, r );
      }
      // 378, 22
      jamonWriter.write("\n");
      // 379, 1
      {
        // 379, 1
        __jamon_innerUnit____init(jamonWriter, r );
      }
      // 379, 20
      jamonWriter.write("\n");
    }
    // 380, 8
    jamonWriter.write("endpackage : ");
    // 381, 14
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(pakkage), jamonWriter);
    // 381, 27
    jamonWriter.write("\n\n`endif  /* ");
    // 383, 12
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(guard), jamonWriter);
    // 383, 23
    jamonWriter.write(" */\n");
  }
  
  
  // 230, 1
  private void __jamon_innerUnit____xdisplay(final java.io.Writer jamonWriter, final Number i, final int w)
    throws java.io.IOException
  {
    // 235, 1
    
int nibbles = (int) Math.ceil(w / 4.0);

    // 238, 1
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format(String.format("%%d'h%%0%dX", nibbles), w, i)), jamonWriter);
  }
  
  
  // 186, 1
  private void __jamon_innerUnit____strfaddr(final java.io.Writer jamonWriter, final int addr)
    throws java.io.IOException
  {
    // 190, 1
    {
      // 190, 1
      __jamon_innerUnit____xdisplay(jamonWriter, addr, addrBits );
    }
  }
  
  
  // 70, 1
  private void __jamon_innerUnit____init(final java.io.Writer jamonWriter, final Register r)
    throws java.io.IOException
  {
    // 74, 1
    
Collection<RegisterField> fields = r.getSortedFields(false, true, false, false);
String func = Utility.underscoreToCamelCase(prefix.toLowerCase().concat("init_").concat(r.getName()), false);

    // 78, 1
    jamonWriter.write("function void ");
    // 78, 15
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(func), jamonWriter);
    // 78, 25
    jamonWriter.write(" (inout [");
    // 78, 34
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getNumberFieldBits() - 1), jamonWriter);
    // 78, 66
    jamonWriter.write(":0] io_data, input string i_datfile);\n    logic [32*");
    // 79, 15
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix.concat(r.getRegisterBase().getName()).concat("_MAX_WIDTH").toUpperCase()), jamonWriter);
    // 79, 100
    jamonWriter.write("-1:0] value;\n    integer code;\n    integer fd;\n    integer line;\n    string  buffer;\n    string  error;\n    string  key;\nbegin\n    fd = $fopen(i_datfile, \"r\");\n    if (fd == 0)\n    begin\n        void'($ferror(fd, error));\n        $display(\"%m: %s: I/O error: %s\", i_datfile, error);\n        $finish(1);\n    end\n    for (line = 0; ; line++)\n    begin\n        code = $fgets(buffer, fd);\n        if (code == 0)\n        begin\n            if ($feof(fd) != 0)\n            begin\n                break;\n            end\n            else\n            begin\n                void'($ferror(fd, error));\n                $display(\"%m: %s:%d: I/O error: %s\", i_datfile, line, error);\n                $finish(1);\n            end\n        end\n        if (buffer.getc(0) == \"#\")\n        begin\n            // Do not process comments.\n            continue;\n        end\n        code = $sscanf(buffer, \"%s %x\", key, value);\n        if (code == 0)\n        begin\n            void'($ferror(fd, error));\n            $display(\"%m: %s:%d: parse error: %s\", i_datfile, line, error);\n            $finish(1);\n        end\n");
    // 122, 1
    
Iterator<RegisterField> it = fields.iterator();

    // 125, 1
    for (int i = 0; it.hasNext(); i++ )
    {
      // 126, 1
      
RegisterField f = it.next();

      // 129, 1
      if (i == 0 )
      {
        // 129, 15
        jamonWriter.write("        if");
      }
      // 131, 1
      else
      {
        // 131, 8
        jamonWriter.write("        else if");
      }
      // 133, 7
      jamonWriter.write(" (key == \"");
      // 133, 17
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getName()), jamonWriter);
      // 133, 34
      jamonWriter.write(".");
      // 133, 35
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.desc), jamonWriter);
      // 133, 47
      jamonWriter.write("\")\n        begin\n            io_data[");
      // 135, 21
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.pos + f.len - 1), jamonWriter);
      // 135, 44
      jamonWriter.write(":");
      // 135, 45
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.pos), jamonWriter);
      // 135, 56
      jamonWriter.write("] = value[");
      // 135, 66
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.len - 1), jamonWriter);
      // 135, 81
      jamonWriter.write(":0];\n        end\n");
    }
    // 137, 8
    jamonWriter.write("    end\n    $fclose(fd);\nend\nendfunction : ");
    // 141, 15
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(func), jamonWriter);
    // 141, 25
    jamonWriter.write("\n");
  }
  
  
  // 196, 1
  private void __jamon_innerUnit____struct(final java.io.Writer jamonWriter, final Register r)
    throws java.io.IOException
  {
    // 200, 1
    
Collection<RegisterField> fields = r.getSortedFields(false, true, true, true);

    // 203, 1
    if (fields == null )
    {
      // 204, 1
      throw new Error(r.getName() + " contains overlapping fields");
    }
    // 205, 7
    jamonWriter.write("typedef struct packed\n{\n");
    // 208, 1
    for (RegisterField f : fields )
    {
      // 208, 34
      jamonWriter.write("    logic ");
      // 209, 11
      if (f.entries > 1 )
      {
        // 209, 32
        jamonWriter.write("[");
        // 209, 33
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.entries - 1), jamonWriter);
        // 209, 52
        jamonWriter.write(":");
        // 209, 53
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.baseEntry), jamonWriter);
        // 209, 70
        jamonWriter.write("]");
      }
      // 209, 77
      jamonWriter.write("[");
      // 210, 2
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.len - 1), jamonWriter);
      // 210, 17
      jamonWriter.write(":0] ");
      // 210, 21
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.desc), jamonWriter);
      // 210, 33
      jamonWriter.write(";\n");
    }
    // 211, 8
    jamonWriter.write("\n} ");
    // 213, 3
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix.toLowerCase()), jamonWriter);
    // 213, 29
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Utility.underscoreToCamelCase(r.getName(), false)), jamonWriter);
    // 213, 84
    jamonWriter.write(";\n");
  }
  
  
  // 46, 1
  private void __jamon_innerUnit____enum(final java.io.Writer jamonWriter, final ConstantsEnum e)
    throws java.io.IOException
  {
    // 50, 1
    
Iterator<ConstantsEnumValue> it = e.values.iterator();
int n = e.values.size();

    // 54, 1
    jamonWriter.write("typedef enum logic [");
    // 54, 21
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getSize() - 1), jamonWriter);
    // 54, 42
    jamonWriter.write(":0]\n{\n");
    // 56, 1
    for (int i = 1; i <= n; i++ )
    {
      // 57, 1
      
ConstantsEnumValue c = it.next();

      // 60, 1
      {
        // 60, 1
        __jamon_innerUnit____decl(jamonWriter, c.getVerilogName().toUpperCase(), null, "    ", __DECL_ENUM_WIDTH );
      }
      // 60, 95
      jamonWriter.write(" = ");
      // 61, 1
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%5s", c.getVerilogEncoding())), jamonWriter);
      // 61, 51
      if (i < n )
      {
        // 61, 64
        jamonWriter.write(",");
      }
      // 61, 71
      jamonWriter.write("\n");
    }
    // 62, 8
    jamonWriter.write("\n} ");
    // 64, 3
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix.toLowerCase()), jamonWriter);
    // 64, 29
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Utility.setFirstLetterCase(e.getName(), false)), jamonWriter);
    // 64, 81
    jamonWriter.write(";\n");
  }
  
  
  // 147, 1
  private void __jamon_innerUnit____regflds(final java.io.Writer jamonWriter, final Register r)
    throws java.io.IOException
  {
    // 151, 1
    
Collection<RegisterField> fields = r.getSortedFields(false, true, false, false);

    // 154, 1
    if (fields == null )
    {
      // 154, 23
      jamonWriter.write("\n");
      // 155, 1
      throw new Error(r.getName() + " contains overlapping fields");
    }
    // 157, 1
    for (RegisterField f : fields )
    {
      // 158, 1
      if (f.len == 1 )
      {
        // 159, 1
        {
          // 159, 1
          __jamon_innerUnit____decl(jamonWriter, r.getName(), "_b_" + f.desc , "localparam", __DECL_DEFAULT_WIDTH);
        }
        // 159, 82
        jamonWriter.write(" = ");
        // 160, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.pos), jamonWriter);
        // 160, 12
        jamonWriter.write(";\n");
      }
      // 161, 1
      else
      {
        // 162, 1
        {
          // 162, 1
          __jamon_innerUnit____decl(jamonWriter, r.getName(), "_l_" + f.desc , "localparam", __DECL_DEFAULT_WIDTH);
        }
        // 162, 82
        jamonWriter.write(" = ");
        // 163, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.pos), jamonWriter);
        // 163, 12
        jamonWriter.write(";\n");
        // 164, 1
        {
          // 164, 1
          __jamon_innerUnit____decl(jamonWriter, r.getName(), "_h_" + f.desc , "localparam", __DECL_DEFAULT_WIDTH);
        }
        // 164, 82
        jamonWriter.write(" = ");
        // 165, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.pos + (f.entries * f.len) - 1), jamonWriter);
        // 165, 38
        jamonWriter.write(";\n");
        // 166, 1
        if (f.entries > 1 )
        {
          // 167, 1
          {
            // 167, 1
            __jamon_innerUnit____decl(jamonWriter, r.getName(), "_s_" + f.desc , "localparam", __DECL_DEFAULT_WIDTH);
          }
          // 167, 82
          jamonWriter.write(" = ");
          // 168, 1
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.len), jamonWriter);
          // 168, 12
          jamonWriter.write(";\n");
        }
      }
    }
  }
  
  
  // 21, 1
  private void __jamon_innerUnit____decl(final java.io.Writer jamonWriter, final String name, final String suffix, final String keyword, final int w)
    throws java.io.IOException
  {
    // 28, 1
    
StringBuilder decl = new StringBuilder();
if (keyword != null) {
    decl.append(keyword);
    decl.append(" ");
}
decl.append(prefix.toUpperCase());
decl.append(name);
if (suffix != null) {
    decl.append(suffix);
}

    // 40, 1
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format(String.format("%%-%ds", w), decl.toString())), jamonWriter);
  }
  
  
}
