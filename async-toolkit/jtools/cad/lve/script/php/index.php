<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd>
<?php
#require '../internal/support/php/utilities.php';
$lveroot="aagrey/rrcwd/lve";
$title="RRC";
if (isset($_REQUEST["tlveroot"]) and $_REQUEST["tlveroot"] != "") {
    $lveroot=$_REQUEST["tlveroot"];
    $lveroot=str_replace("/mnt/fulcrum/", "", $lveroot);
    $lveroot=str_replace("/home/", "home/", $lveroot);
    $title=$lveroot;
}
elseif (isset($_REQUEST["lveroot"])) {
    $lveroot=$_REQUEST["lveroot"];
    $lveroot=str_replace("/mnt/fulcrum/", "", $lveroot);
    $lveroot=str_replace("/home/", "home/", $lveroot);
    $title=$lveroot;
}
$handle=fopen("lvedirs.txt", "r");
$list=array();
$ulist=array();
while(!feof($handle)) {
    $item = str_replace("\n", "", fgets($handle));
    $file = "/p/work/$item/index.table";
    if (is_readable ($file)) {
        $stat = stat($file);
        $uid = $stat[4];
        $list[] = "$item";
        $ulist[] = $uid;
    }
}
fclose($handle);
?>
<HTML>
<HEAD>
<!-- Generated by Layout Verification Engine on $date -->
<TITLE>Analog Verification</TITLE>
<LINK REL ="stylesheet" TYPE="text/css" HREF="table.css" TITLE="Style">
</HEAD>
<BODY BGCOLOR="#ffffff">
<?php
?>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<TR>
<TD><TD ALIGN="LEFT" HEIGHT="90"><IMG SRC="logo.png " WIDTH="250" HEIGHT="90" ALT
="Fulcrum" BORDER="0" align="left"></A>
</TD>
</TR>
</TABLE>
<!-- ========== START OF NAVBAR ========== -->
<A NAME="navbar_top"><!-- --></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0">
<TR>
<TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="5" CELLSPACING="3">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
  <A HREF="/eng/<?php echo $lveroot ?>/index.html"><FONT CLASS="NavBarCell1Rev"><B>Static&nbsp;Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
  <A HREF="/eng/<?php echo $lveroot ?>/status.html"><FONT CLASS="NavBarFont1"><B>Tracking</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
  <A HREF="http://fddp.internal.avlsi.com/index.php/Lve"><FONT CLASS="NavBarFont1"><B>Help&nbsp;Doc</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
  <A HREF="/eng/<?php echo $lveroot ?>/statistics.html"><FONT CLASS="NavBarFont1"><B>Statistics</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
</TR>
</TR>
</TABLE>
<!-- =========== END OF NAVBAR =========== -->
<P>
<BODY>


<CENTER><H2>
Analog Verification
</H2></CENTER>

<?php

//hard-coded include files for invoking cast_query; in the future this
//should be filled in by some project config file or something of the sort!
#$cast_dir="/mnt/fulcrum/alta/aubrey/alta/cast";
$cast_dir="/mnt/fulcrum/local/checkouts/alta/alta/cast";
#$spec_dir="/mnt/fulcrum/alta/aubrey/alta/spec";
$spec_dir="/mnt/fulcrum/local/checkouts/alta/alta/layout/tsmc65/spec";
$output_file=tempnam("/tmp","lve");
$cast_query="/usr/local/bin/fulcrum cast_query  ";
$elements = array();

//provide search capability for tests and status

$cellname="";
if (isset($_POST['FQCN'])) $cellname=$_POST['FQCN'];
//read and set the option variables here
if(isset($_POST["JLVS"]) || isset($_POST["LVS"]) ||
   isset($_POST["EXTRACT"]) ||  isset($_POST["DRC"]) ||
   isset($_POST["HDRC"]) || isset($_POST["FRC"]) ||
   isset($_POST["ALINT"]) || isset($_POST["ASPICE"]) ||
   isset($_POST["HLVS"]) || isset($_POST["LIB"]) ||
   isset($_POST["ASTA"])) {

$cellname = $_POST["FQCN"];
$jlvs = $_POST["JLVS"];
$lvs = $_POST["LVS"];
$hlvs = $_POST["HLVS"];
$extract = $_POST["EXTRACT"];
$drc = $_POST["DRC"];
$hdrc = $_POST["HDRC"];
$frc = $_POST["FRC"];
$alint = $_POST["ALINT"];
$aspice = $_POST["ASPICE"];
$lib = $_POST["LIB"];
$asta = $_POST["ASTA"];

$pass = $_POST["PASS"];
$na = $_POST["NA"];
$fail = $_POST["FAIL"];
$not_tested = $_POST["NOT_TESTED"];
$sign_off = $_POST["SIGNOFF"];
$other = $_POST["OTHER"];
$hier = "";
}
 else {
$cellname = "";
$jlvs = "JLVS";
$lvs = "LVS";
$hlvs = "HLVS";
$extract = "EXTRACT";
$drc = "DRC";
$hdrc = "HDRC";
$frc = "FRC";
$alint = "ALINT";
$aspice = "ASPICE";
$lib = "LIB";
$asta = "ASTA";
$pass = "PASS";
$na = "NA";
$fail = "FAIL";
$not_tested = "NOT_TESTED";
$sign_off = "SIGNOFF";
$other = "OTHER";
$hier = "";
}

//this section is meant to be used by static pages to leverage
//all the search features of this page
$LinkArgs=0;
if($LinkArgs > 0){
  if($Jlvs > 0)$jlvs = "JLVS"; else $jlvs = "";
  if($Lvs > 0)$lvs = "LVS"; else $lvs = "";
  if($Hlvs > 0)$hlvs = "HLVS"; else $hlvs = "";
  if($Extract >0)$extract="EXTRACT"; else $extract = "";
  if($Drc > 0)$drc="DRC"; else $drc = "";
  if($Hdrc > 0)$hdrc="HDRC"; else $hdrc = "";
  if($Frc > 0)$frc="FRC"; else $frc = "";
  if($Alint > 0)$alint="ALINT"; else $alint = "";
  if($Aspice > 0)$aspice="ASPICE"; else $aspice = "";
  if($Lib > 0)$lib="LIB"; else $lib = "";
  if($Asta > 0)$asta="LIB"; else $asta = "";
  if($Pass > 0)$pass="PASS"; else $pass = "";
  if($Na > 0)$na="NA"; else $na = "";
  if($Fail > 0)$fail="FAIL"; else $fail = "";
  if($Nottested > 0)$not_tested="NOT_TESTED"; else $not_tested = "";
  if($Signoff > 0)$sign_off="SIGN_OFF"; else $sign_off = "";
  $other="";
}

//set check box variable for different test categories
if($jlvs == "JLVS"){$jlvs_checked = "CHECKED"; } else {$jlvs_checked = "";}
if($lvs == "LVS"){$lvs_checked = "CHECKED"; } else {$lvs_checked = "";}
if($hlvs == "HLVS"){$hlvs_checked = "CHECKED"; } else {$hlvs_checked = "";}
if($extract == "EXTRACT"){$extract_checked = "CHECKED"; } else {$extract_checked = "";}
if($drc == "DRC"){$drc_checked = "CHECKED"; } else {$drc_checked = "";}
if($hdrc == "HDRC"){$hdrc_checked = "CHECKED"; } else {$hdrc_checked = "";}
if($frc == "FRC"){$frc_checked = "CHECKED"; } else {$frc_checked = "";}
if($alint == "ALINT"){$alint_checked = "CHECKED"; } else {$alint_checked = "";}
if($aspice == "ASPICE"){$aspice_checked = "CHECKED"; } else {$aspice_checked = "";}
if($lib == "LIB"){$lib_checked = "CHECKED"; } else {$lib_checked = "";}
if($asta == "ASTA"){$asta_checked = "CHECKED"; } else {$asta_checked = "";}

//set check box varibles for different status categories
if($pass == "PASS"){$pass_checked = "CHECKED"; } else {$pass_checked = "";}
if($na == "NA"){$na_checked = "CHECKED"; } else {$na_checked = "";}
if($fail == "FAIL"){$fail_checked = "CHECKED"; } else {$fail_checked = "";}
if($not_tested == "NOT_TESTED"){$not_tested_checked = "CHECKED"; }
else {$not_tested_checked = "";}
if($sign_off == "SIGNOFF"){$sign_off_checked = "CHECKED"; }
else {$sign_off_checked = "";}
if($other == "OTHER"){$other_checked = "CHECKED"; } else {$other_checked = "";}
if($hier == "HIER"){$hier_checked = "CHECKED"; } else {$hier_checked = "";}

// =========== START SEARCH/CONFIG ===========
print "<FORM ACTION=index.php METHOD=POST >\n";
$stat = stat("/p/work/$lveroot/index.table");
$uid = $stat[4];
#$ldap = initialize_ldap();
#$bind = ldap_bind($ldap);
#$dnu = "ou=people,dc=internal,dc=avlsi,dc=com";
#$ufilter="(&(objectClass=fulcrumPerson)(uidNumber=$uid))";
#$uattr=array("gecos");
#$fnd_name=ldap_search($ldap,$dnu,$ufilter,$uattr);
#$gecos="";
#if ($fnd_name !== FALSE) {
#    $info = ldap_get_entries($ldap,$fnd_name);
#    if ($info["count"] == 1) {
#        $gecos=$info[0]["gecos"][0];
#    }
#}
#print "<input type=hidden name=lveroot value=\"$lveroot\">\n";
#print "<input type=hidden name=title value=\"$title\">\n";
print "<TABLE BORDER=\"0\"  WIDTH=\"100%\" CELLPADDING=\"2\" CELLSPACING=\"3\" >\n";
print "<TR><TD colspan=2>";
print "<B>LVE ROOT :</B> <select name=lveroot>";
$match=0;
foreach ($list as $value) {
    if ( $value === $lveroot ) {
        print "<option selected>$value";
        $match=1;
    }
    else {
        print "<option>$value";
    }
}
if (! $match) {
    print "<option selected>$lveroot";
}
$escaped_cellname = str_replace("(", "\\(", $cellname);
$escaped_cellname = str_replace(")", "\\)", $escaped_cellname);
$escaped_cellname = str_replace("{", "\\{", $escaped_cellname);
$escaped_cellname = str_replace("}", "\\}", $escaped_cellname);
print "</select>";
print "&nbsp; or Type Root: <input type=text value=\"\" name=\"tlveroot\" size=32>";
print "</TD></TR>";
print "<TR><td>\n";
print "<B>FQCN:</B> \n";
print "<INPUT TYPE=TEXT  NAME=\"FQCN\" VALUE=\"$cellname\" SIZE=64 MAXLENGTH=1024 >\n";
print "<P></td><td>\n";
print "<INPUT TYPE=CHECKBOX $hier_checked NAME=HIER VALUE=\"HIER\" > <b>Hierarchical Descent </b><BR>\n";
print "</TD>\n";
print "</TABLE><P>\n";

print "<TABLE BORDER=\"0\" WIDTH=\"100%\" CELLPADDING=\"2\" CELLSPACING=\"3\" >\n";
print "<td>\n";
print "<B>Result Category:</B>\n";
print "<P>\n";
print "<INPUT TYPE=CHECKBOX $jlvs_checked NAME=JLVS VALUE=\"JLVS\" > JLVS <BR>\n";
print "<INPUT TYPE=CHECKBOX $lvs_checked NAME=LVS VALUE=\"LVS\" > LVS <BR>\n";
print "<INPUT TYPE=CHECKBOX $hlvs_checked NAME=HLVS VALUE=\"HLVS\" > HLVS <BR>\n";
print "<INPUT TYPE=CHECKBOX $extract_checked NAME=EXTRACT VALUE=\"EXTRACT\" > EXTRACT <BR>\n";
print "<INPUT TYPE=CHECKBOX $drc_checked NAME=DRC VALUE=\"DRC\" > DRC <BR>\n";
print "<INPUT TYPE=CHECKBOX $hdrc_checked NAME=HDRC VALUE=\"HDRC\" > HDRC <BR>\n";
print "<INPUT TYPE=CHECKBOX $frc_checked NAME=FRC VALUE=\"FRC\" > FRC <BR>\n";
print "<INPUT TYPE=CHECKBOX $alint_checked NAME=ALINT VALUE=\"ALINT\" > ALINT <BR>\n";
print "<INPUT TYPE=CHECKBOX $aspice_checked NAME=ASPICE VALUE=\"ASPICE\" > ASPICE <BR>\n";
print "<INPUT TYPE=CHECKBOX $lib_checked NAME=LIB VALUE=\"LIB\" > LIB <BR>\n";
print "<INPUT TYPE=CHECKBOX $asta_checked NAME=ASTA VALUE=\"ASTA\" > ASTA <BR>\n";
print "<P></td><td>\n";

print "<B>Result Status:</B>\n";
print "<P>\n";
print "<INPUT TYPE=CHECKBOX $pass_checked NAME=PASS VALUE=\"PASS\" > PASS <BR>\n";
print "<INPUT TYPE=CHECKBOX $na_checked NAME=NA VALUE=\"NA\" > NA <BR>\n";
print "<INPUT TYPE=CHECKBOX $fail_checked NAME=FAIL VALUE=\"FAIL\" > FAIL <BR>\n";
print "<INPUT TYPE=CHECKBOX $not_tested_checked NAME=NOT_TESTED VALUE=\"NOT_TESTED\" > NOT_TESTED/INCOMPLETE <BR>\n";
print "<INPUT TYPE=CHECKBOX $sign_off_checked NAME=SIGNOFF VALUE=\"SIGNOFF\" > SIGNOFF <BR>\n";
print "<INPUT TYPE=CHECKBOX $other_checked NAME=OTHER VALUE=\"OTHER\" > OTHER <BR>\n";
print "</td></TABLE>\n";
print "<center><INPUT TYPE=SUBMIT VALUE=\"I'm Feeling Lucky\" > </center>\n";
print "</FORM>";
print "<HR>\n";

//if hierarchical decent is specified run cast_query
if($hier == "HIER"){
  $cast_query_cmd="$cast_query --cast-path=$cast_dir:$spec_dir";
  $cast_query_cmd="$cast_query_cmd --output=$output_file --max-heap-size=1500M";
  $cast_query_cmd="$cast_query_cmd --task=subcells --cell=\"$cellname\"";
  $handle = popen("$cast_query_cmd 2>/dev/null", 'r');
  while(!feof($handle)) {
    $output .= fgets($handle);
    $output .= "<br>";
  }
  pclose($handle);
  if(filesize($output_file) == 0){
    print "<b>cast_query failed: your request did not make sense!</b><p>\n";
    print "Make sure your cell $cell exits in $cast_dir:$spec_dir<br>";
    print "Hopefully the cast tree isn't broken; that will suck!<p>";
    print "$cast_query_cmd";
    print "$output";
  }
  else {
    $query_data = fopen("$output_file", "r");
    //populate table for pickings
    while("$query_data" != "" and !feof($query_data)){
      $element = fgets($query_data);
      $element = chop($element);
      if($element != ""){
	$elements[$element] = 1;
      }
    }
    fclose($query_data);
  }
  unlink($output_file);
}

function meets_criteria($arg, $pass, $na, $fail, $not_tested, $sign_off, $other){
    if($arg == $pass)return true;
    if($arg == $na)return true;
    if($arg == $fail)return true;
    if($arg == $not_tested)return true;
    if($arg == $sign_off)return true;
    if($arg == $other)return true;
   return false;
}

//create the color palette here
$color_palette = array ( "PASS" => "white",
			 "NA" => "white",
                         "FAIL" => "red",
                         "NOT_TESTED" => "lightblue",
			 "INCOMPLETE" => "lightblue",
                         "SIGNOFF" => "yellow",
                         "OTHER" => "lightgreen"
                         );

//open data file for read and start writing table
$table = "/p/work/".$lveroot."/index.table";
$data_file = fopen("$table", "r");
if ("$data_file" == "") {
    print "$table cannot be opened";
    exit (1);
}
$buffer = fgets($data_file);
preg_match_all("/(\S*):=(\S*)/",$buffer,$hdrmatches,PREG_SET_ORDER);
for($i = 0; $i < count($hdrmatches); $i++)
    $ndxcol[$hdrmatches[$i][1]] = $i;

$hdrorder = array("CELL", "JLVS", "LVS", "HLVS", "EXTRACT", "DRC", "HDRC", "FRC", "ALINT", "ASPICE", "LIB", "ASTA");

rewind($data_file);

// we have to break up the single string because
// something fails over 6000000 characters.
$html_entry_ndx=0;
$html_entry[$html_entry_ndx] = "";

//open the data file read contents and construct the desired table
$html_entry[$html_entry_ndx] .= "<TABLE BORDER=1 CELLPADDING=2 CELLSPACING=3 class=\"yellow\" >\n";
$html_entry[$html_entry_ndx] .= "<TBODY>\n";

//generate column headings
function write_header ($jlvs,$lvs,$hlvs,$extract,$drc,$hdrc,$frc,$alint,$aspice,$lib,$asta){
  global $hdrorder;
  $html_entry = "<tr BGCOLOR=\"#CCCCFF\" class=\"yellow\">\n";
  $html_entry .= "<td class=\"yellow\" <b>CELL</b> </td>";
  // get order from actual index file
  for ($i = 1; $i < count($hdrorder); $i++) {
      $lc = strtolower($hdrorder[$i]);
      $do = 0;
      eval ("if ( \$$lc == \"".$hdrorder[$i]."\" ) \$do = 1;");
      if ($do)
          $html_entry .= "<td class=\"yellow\" <b>".$hdrorder[$i]."</b> </td>";
  }
  $html_entry .= "</tr>";
  return $html_entry;
}
$html_entry[$html_entry_ndx] .= write_header($jlvs,$lvs,$hlvs,$extract,$drc,$hdrc,$frc,$alint,$aspice,$lib,$asta);
$cells_matched = 0;

while(!feof($data_file)){

  $buffer = fgets($data_file);
  preg_match_all("/(\S*):=(\S*)/",$buffer,$matches,PREG_SET_ORDER);
  $search_match = false;
  $tmp_html_entry = "";
  $is_tr=0;

  for ($c=0; $c < count($hdrorder); $c++) {

    //start from 1 since the it stores KEY:=VALUE pair
    //results are stored as KEY=VALUE, KEY, VALUE

    $i = $ndxcol[$hdrorder[$c]];
    if (!isset($matches[$i])) continue;
    //set all the variables read here
    if($matches[$i][1] == "CELL"){$f_cell = $matches[$i][2]; }
    if($matches[$i][1] == "JLVS"){$f_jlvs = $matches[$i][2]; }
    if($matches[$i][1] == "LVS"){$f_lvs = $matches[$i][2]; }
    if($matches[$i][1] == "HLVS"){$f_hlvs = $matches[$i][2]; }
    if($matches[$i][1] == "EXTRACT"){$f_extract = $matches[$i][2]; }
    if($matches[$i][1] == "DRC"){$f_drc = $matches[$i][2]; }
    if($matches[$i][1] == "HDRC"){$f_hdrc = $matches[$i][2]; }
    if($matches[$i][1] == "FRC"){$f_frc = $matches[$i][2]; }
    if($matches[$i][1] == "ALINT"){$f_alint = $matches[$i][2]; }
    if($matches[$i][1] == "ASPICE"){$f_aspice = $matches[$i][2]; }
    if($matches[$i][1] == "LIB"){$f_lib = $matches[$i][2]; }
    if($matches[$i][1] == "ASTA"){$f_asta = $matches[$i][2]; }

    if(((preg_match("/$escaped_cellname/",$f_cell) > 0) && $hier !="HIER" ) ||
       ($hier == "HIER" && isset($elements[$f_cell]))){

      if($hier == "HIER"){
	$elements[$f_cell] = 0;
      }

      if($matches[$i][1] == "CELL"){

        if(strlen($f_cell) > 64){
          $fa_cell = substr($f_cell,0,64);
          $fa_cell = $fa_cell."...";
        }
        else {
           $fa_cell = $f_cell;
        }

        $f_link = str_replace(".", "/", $f_cell);
        $f_link .= "/cell.html";
        $f_link = "/work/".$lveroot."/".$f_link;
        $tmp_html_entry .= "<tr><td class=\"yellow\"> <a href=\"$f_link\">$fa_cell</a></td>";
      }

      if($matches[$i][1] == "JLVS" && $jlvs == "JLVS"){
        $search_match |= meets_criteria($f_jlvs,$pass, $na, $fail, $not_tested, $sign_off, $other);
        $tmp_html_entry .= "<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_jlvs]\" >$f_jlvs</td>";
      }

      if($matches[$i][1] == "LVS" && $lvs == "LVS"){
        $search_match |= meets_criteria($f_lvs, $pass,$na,$fail,$not_tested, $sign_off, $other);
        $tmp_html_entry .= "<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_lvs]\">$f_lvs</td>";
      }

      if($matches[$i][1] == "HLVS" && $hlvs == "HLVS"){
        $search_match |= meets_criteria($f_hlvs, $pass,$na,$fail,$not_tested, $sign_off, $other);
        $tmp_html_entry .= "<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_hlvs]\">$f_hlvs</td>";
      }

      if($matches[$i][1] == "EXTRACT" && $extract == "EXTRACT"){
        $search_match |= meets_criteria($f_extract, $pass,$na,$fail,$not_tested, $sign_off, $other);
        $tmp_html_entry .= "<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_extract]\">$f_extract</td>";
      }

      if($matches[$i][1] == "DRC" && $drc == "DRC"){
         $search_match |= meets_criteria($f_drc,$pass,$na,$fail,$not_tested, $sign_off, $other);
         $tmp_html_entry .= "<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_drc]\">$f_drc</td>";
      }

      if($matches[$i][1] == "HDRC" && $hdrc == "HDRC"){
         $search_match |= meets_criteria($f_hdrc,$pass,$na,$fail,$not_tested, $sign_off, $other);
         $tmp_html_entry .= "<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_hdrc]\">$f_hdrc</td>";
      }

      if($matches[$i][1] == "FRC" && $frc == "FRC"){
         $search_match |= meets_criteria($f_frc,$pass,$na,$fail,$not_tested, $sign_off, $other);
         $tmp_html_entry .= "<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_frc]\">$f_frc</td>";
      }
      if($matches[$i][1] == "ALINT" && $alint == "ALINT"){
         $search_match |= meets_criteria($f_alint,$pass,$na,$fail,$not_tested, $sign_off, $other);
         $tmp_html_entry .="<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_alint]\">$f_alint</td>";
      }
      if($matches[$i][1] == "ASPICE" && $aspice == "ASPICE"){
         $search_match |= meets_criteria($f_aspice,$pass,$na,$fail,$not_tested, $sign_off, $other);
         $tmp_html_entry.="<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_aspice]\">$f_aspice</td>";
      }
      if($matches[$i][1] == "LIB" && $lib == "LIB"){
         $search_match |= meets_criteria($f_lib,$pass,$na,$fail,$not_tested, $sign_off, $other);
         $tmp_html_entry.="<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_lib]\">$f_lib</td>";
      }
      if($matches[$i][1] == "ASTA" && $asta == "ASTA"){
         $search_match |= meets_criteria($f_asta,$pass,$na,$fail,$not_tested, $sign_off, $other);
         $tmp_html_entry.="<td class=\"yellow\" BGCOLOR=\"$color_palette[$f_asta]\">$f_asta</td>";
      }
    }
  }

  $tmp_html_entry .= "</tr>\n";
  if($search_match){
    $html_entry[$html_entry_ndx] .= $tmp_html_entry; $cells_matched++;
    if($cells_matched%40 == 0 && $cells_matched/40 >= 1){
      $html_entry_ndx++;
      $html_entry[$html_entry_ndx] .= write_header($jlvs,$lvs,$hlvs,$extract,$drc,$hdrc,$frc,$alint,$aspice,$lib,$asta);
    }
  }
}
//end the table
$html_entry[$html_entry_ndx] .= "</TABLE><P>";

if($cells_matched == 0)print "<b>Search Results ... zarro cells found <p></b>\n";
elseif($cells_matched == 1)print "<b>Search Results ... $cells_matched cell found <p></b>\n";
else print "<b>Search Results ... $cells_matched cells found <p></b>\n";

//argh, I'd rather use a better data structure of this; array() struct sucks!
//ideally we'd unpopulate the array as we determine that they been tested; then
//all we have to do is
$left_overs = "";
$left_overs_num = 0;
if($hier == "HIER"){
  foreach($elements as $key => $value) {
    if($value == 1){
      $left_overs .= "$key<br>";
      $left_overs_num++;
    }
  }
  if($left_overs_num > 0){
    print "<b>No attempt has been made to run these cells ($left_overs_num):</b><p>\n";
    print "$left_overs\n";
    print "<HR>\n";
  }
}

for( $ndx = 0; $ndx <= $html_entry_ndx; $ndx++) {
    print "$html_entry[$ndx]";
    $html_entry[$ndx] = "";
}

//done reading and displaying data; close the file
fclose($data_file);

//end php section
date_default_timezone_set("America/Los_Angeles");
$date = getdate();
$year = $date['year'];
print "<HR>\n";
print "<I>Intel Corporation.</I>&copy Copyright $year. All Rights Reserved.<br>";
print "</BODY>\n"
?>
</HTML>
