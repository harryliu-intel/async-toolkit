// Autogenerated Jamon implementation
// /nfs/sc/proj/ctg/mrl108/rliu68/sw-intel5/cad/java/src/./com/fulcrummicro/hw/verification/chip/mgmt/registers/templates/Perl.jamon

package com.fulcrummicro.hw.verification.chip.mgmt.registers.templates;

// 8, 1
import java.util.Collection;
// 9, 1
import java.util.Collections;
// 10, 1
import java.util.Comparator;
// 11, 1
import java.util.Iterator;
// 12, 1
import java.util.List;
// 13, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnum;
// 14, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnumValue;
// 15, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.Register;
// 16, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.RegisterBase;
// 17, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.RegisterField;
// 18, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.RegisterStruct;
// 19, 1
import com.fulcrummicro.util.misc.Utility;

public class PerlImpl
  extends com.fulcrummicro.util.jamon.timestampImpl
  implements com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.Perl.Intf

{
  private final Collection<RegisterBase> bases;
  private final String prefix;
  private final String basename;
  private final String namespace;
  private final boolean testpoint;
  // 326, 1
  
static class ConstantsEnumValueComparator implements Comparator<ConstantsEnumValue> {

    public int compare(ConstantsEnumValue o1, ConstantsEnumValue o2) {
        return Integer.valueOf(o1.getEncoding()).compareTo(o2.getEncoding());
    }

}
static int ndims(Register r) {
    if (r.getNumDimensions() == 1 && r.getNumEntries() == 1) {
        return 0;
    }
    return r.getNumDimensions();
}
static List<Register> regs = null;
static String[] FV_PERL_INDEX = new String[]{"$index2", "$index1", "$index0", "$word"};
static final int FV_PERL_WIDTH_DEFAULT = -1;
static int FV_PERL_WIDTH = FV_PERL_WIDTH_DEFAULT;

  protected static com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.Perl.ImplData __jamon_setOptionalArguments(com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.Perl.ImplData p_implData)
  {
    com.fulcrummicro.util.jamon.timestampImpl.__jamon_setOptionalArguments(p_implData);
    return p_implData;
  }
  public PerlImpl(org.jamon.TemplateManager p_templateManager, com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.Perl.ImplData p_implData)
  {
    super(p_templateManager, __jamon_setOptionalArguments(p_implData));
    bases = p_implData.getBases();
    prefix = p_implData.getPrefix();
    basename = p_implData.getBasename();
    namespace = p_implData.getNamespace();
    testpoint = p_implData.getTestpoint();
  }
  
  @Override protected void child_render_1(final java.io.Writer jamonWriter)
    throws java.io.IOException
  {
    // 345, 1
    
String module = namespace.length() > 0 ?
                namespace.concat("::").concat(basename) :
                basename;

    // 350, 1
    jamonWriter.write("# vim:et:sw=4:ts=4:tw=79\n# (No tabs, indent level is 4, text width is 79)\n\n###############################################################################\n# File:             ");
    // 354, 21
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(module.replaceAll("::", "/")), jamonWriter);
    // 354, 55
    jamonWriter.write(".pm\n# Creation Date:    December 18, 2008\n# Last Updated:     ");
    // 356, 21
    {
      // 356, 21
      __jamon_innerUnit__timestamp(jamonWriter);
    }
    // 356, 37
    jamonWriter.write("\n# Description:      Perl register utility variables and subroutines.\n#\n# INTEL CONFIDENTIAL\n# Copyright ");
    // 360, 13
    {
      // 360, 13
      __jamon_innerUnit__copyright_year(jamonWriter, 2008 );
    }
    // 360, 54
    jamonWriter.write(" Intel Corporation.\n# All Rights Reserved.\n#\n# The source code contained or described herein and all documents related\n# to the source code (\"Material\") are owned by Intel Corporation or its\n# suppliers or licensors. Title to the Material remains with Intel\n# Corporation or its suppliers and licensors. The Material contains trade\n# secrets and proprietary and confidential information of Intel or its\n# suppliers and licensors. The Material is protected by worldwide copyright\n# and trade secret laws and treaty provisions. No part of the Material may\n# be used, copied, reproduced, modified, published, uploaded, posted,\n# transmitted, distributed, or disclosed in any way without Intel's prior\n# express written permission.\n#\n# No license under any patent, copyright, trade secret or other intellectual\n# property right is granted to or conferred upon you by disclosure or\n# delivery of the Materials, either expressly, by implication, inducement,\n# estoppel or otherwise. Any license under such intellectual property rights\n# must be express and approved by Intel in writing.\n#\n# THIS FILE IS AUTOMATICALLY GENERATED - DO NOT MODIFY.\n###############################################################################\n\npackage ");
    // 383, 9
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(module), jamonWriter);
    // 383, 21
    jamonWriter.write(";\nuse strict;\nuse warnings;\n\nuse base qw(Exporter);\n\n");
    // 389, 1
    if (testpoint )
    {
      // 389, 18
      jamonWriter.write("our @EXPORT = qw(\n");
      // 391, 1
      for (RegisterBase b : bases )
      {
        // 392, 1
        for (Register r : b.getRegisters() )
        {
          // 392, 39
          jamonWriter.write("    ");
          // 393, 5
          {
            // 393, 5
            __jamon_innerUnit____strfname(jamonWriter, r.getName() , "");
          }
          // 393, 41
          jamonWriter.write("\n");
        }
      }
      // 395, 8
      jamonWriter.write(");\n");
    }
    // 397, 7
    jamonWriter.write("our @EXPORT_FAIL = qw(_panic _validatePrototype);\n\n###############################################################################\n# Local Variables\n###############################################################################\n\nuse constant INDENT => \"  \";\n\n###############################################################################\n# Local Functions\n###############################################################################\n\nsub _panic($)\n{\n    my ($format, @arguments) = @_;\n\n    my ($level);\n\n    open(STDOUT, \">&STDERR\");\n    for ($level = 1; ; $level++)\n    {\n        my ($package, $file, $line, $subroutine) = caller($level);\n        if (!defined($subroutine) || $subroutine eq \"(eval)\")\n        {\n            last;\n        }\n        $file =~ s,(perl|te2)/+,,;\n        printf(\"%s$subroutine at $file line $line:\\n\", INDENT x ($level - 1));\n    }\n    printf(\"%s$format\\n\", INDENT x ($level - 1), @arguments);\n    die();\n}\n\nsub _validatePrototype(\\@$;$)\n{\n    my ($arguments, $m, $n) = @_;\n\n    $n = defined($n) ? $n : $m;\n\n    my ($package, $file, $line, $subroutine) = caller(1);\n    if (scalar(@{$arguments}) < $m)\n    {\n        _panic(\"Not enough arguments for $subroutine\");\n    }\n    elsif ($n != -1 && scalar(@{$arguments}) > $n)\n    {\n        _panic(\"Too many arguments for $subroutine\");\n    }\n    for (my $i = 0; $i < $n; $i++)\n    {\n        if (!defined($arguments->[$i]))\n        {\n            _panic(\"$subroutine: argument $i not defined\");\n        }\n        elsif ($arguments->[$i] != int($arguments->[$i]))\n        {\n            _panic(\"$subroutine: argument $i not an integer\");\n        }\n    }\n}\n\n");
    // 459, 1
    for (RegisterBase b : bases )
    {
      // 460, 1
      
regs = b.getRegisters();

      // 465, 1
      
FV_PERL_WIDTH = FV_PERL_WIDTH_DEFAULT;
for (RegisterStruct s : b.getStructs()) {
    Iterator<String> it = s.getFieldIter();
    int l = s.getName().length();
    while (it.hasNext()) {
        RegisterField f = s.getField(it.next());
        FV_PERL_WIDTH = Math.max(FV_PERL_WIDTH, l + f.desc.length());
    }
}
for (ConstantsEnum e : b.getEnums()) {
    int l = e.getName().length();
    for (ConstantsEnumValue value : e.values) {
        FV_PERL_WIDTH = Math.max(FV_PERL_WIDTH, l + value.getName().length());
    }
}
for (Register r : b.getRegisters()) {
    Iterator<String> it = r.getFieldIter();
    int l = r.getName().length();
    while (it.hasNext()) {
        RegisterField f = r.getField(it.next());
        FV_PERL_WIDTH = Math.max(FV_PERL_WIDTH, l + f.desc.length());
    }
}

      // 493, 1
      
FV_PERL_WIDTH += prefix.length() + 3;

      // 496, 1
      jamonWriter.write("###############################################################################\n# ");
      // 497, 3
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(b.getFullName()), jamonWriter);
      // 497, 24
      jamonWriter.write("\n###############################################################################\n\nour $");
      // 500, 6
      {
        // 500, 6
        __jamon_innerUnit____wstrfname(jamonWriter, b.getFullName() , "", FV_PERL_WIDTH);
      }
      // 500, 47
      jamonWriter.write(" = ");
      // 501, 1
      {
        // 501, 1
        __jamon_innerUnit____strfaddr(jamonWriter, b.getAbsoluteAddress() );
      }
      // 501, 48
      jamonWriter.write(";\nour $");
      // 502, 6
      {
        // 502, 6
        __jamon_innerUnit____wstrfname(jamonWriter, b.getName(), "_SIZE" , FV_PERL_WIDTH);
      }
      // 502, 61
      jamonWriter.write(" = ");
      // 503, 1
      {
        // 503, 1
        __jamon_innerUnit____strfaddr(jamonWriter, b.getSize() );
      }
      // 503, 37
      jamonWriter.write(";\n\n");
      // 505, 1
      for (RegisterStruct s : b.getStructs() )
      {
        // 506, 1
        {
          // 506, 1
          __jamon_innerUnit____width(jamonWriter, s );
        }
        // 507, 1
        {
          // 507, 1
          __jamon_innerUnit____fields(jamonWriter, s );
        }
        // 507, 22
        jamonWriter.write("\n");
      }
      // 510, 1
      for (ConstantsEnum e : b.getEnums() )
      {
        // 513, 1
        
Collections.sort(e.values, new ConstantsEnumValueComparator());

        // 516, 1
        for (ConstantsEnumValue value : e.values )
        {
          // 517, 1
          
String name = Utility.possibleUnderscoreToLowerCase(e.getName()).toUpperCase();

          // 523, 1
          jamonWriter.write("sub ");
          // 523, 5
          {
            // 523, 5
            __jamon_innerUnit____wstrfname(jamonWriter, name, "__" + value.getName() , FV_PERL_WIDTH);
          }
          // 523, 68
          jamonWriter.write("  { return ");
          // 524, 10
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(value.getEncoding()), jamonWriter);
          // 524, 35
          jamonWriter.write("; }\n");
        }
        // 525, 8
        jamonWriter.write("\n");
      }
      // 528, 1
      for (Register r : regs )
      {
        // 529, 1
        {
          // 529, 1
          __jamon_innerUnit____width(jamonWriter, r );
        }
        // 530, 1
        {
          // 530, 1
          __jamon_innerUnit____stride(jamonWriter, r );
        }
        // 531, 1
        {
          // 531, 1
          __jamon_innerUnit____fields(jamonWriter, r );
        }
        // 531, 22
        jamonWriter.write("\n");
      }
      // 534, 1
      for (Register r : regs )
      {
        // 535, 1
        
String woffset = r.getEntryWidth() > 1 ? " + " + FV_PERL_INDEX[3] : "";
int nDims = ndims(r);
boolean md = r.getNumEntries1() > 1;

        // 540, 1
        jamonWriter.write("sub ");
        // 540, 5
        {
          // 540, 5
          __jamon_innerUnit____strfname(jamonWriter, r.getName() , "");
        }
        // 540, 41
        jamonWriter.write("\n{\n");
        // 542, 1
        {
          // 542, 1
          __jamon_innerUnit____preamble(jamonWriter, r, nDims );
        }
        // 542, 39
        jamonWriter.write("    return ");
        // 544, 1
        if (nDims == 0 )
        {
          // 544, 19
          jamonWriter.write("(");
          // 545, 2
          {
            // 545, 2
            __jamon_innerUnit____baseaddr(jamonWriter, r );
          }
          // 545, 25
          jamonWriter.write(" + ");
          // 545, 28
          {
            // 545, 28
            __jamon_innerUnit____strfaddr(jamonWriter, r.getAddressOffset() );
          }
          // 546, 1
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(woffset), jamonWriter);
          // 546, 14
          jamonWriter.write("); ");
        }
        // 547, 1
        else if (nDims == 1 )
        {
          // 547, 23
          jamonWriter.write("(");
          // 548, 2
          {
            // 548, 2
            __jamon_innerUnit____baseaddr(jamonWriter, r );
          }
          // 548, 25
          jamonWriter.write(" + ");
          // 548, 28
          {
            // 548, 28
            __jamon_innerUnit____strfaddr(jamonWriter, r.getAddressOffset() );
          }
          // 548, 73
          jamonWriter.write(" + ");
          // 549, 3
          {
            // 549, 3
            __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace() );
          }
          // 549, 45
          jamonWriter.write(" * (");
          // 550, 2
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(FV_PERL_INDEX[2]), jamonWriter);
          // 550, 24
          jamonWriter.write(" - ");
          // 550, 27
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry()), jamonWriter);
          // 550, 49
          jamonWriter.write(")");
          // 551, 1
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(woffset), jamonWriter);
          // 551, 14
          jamonWriter.write("); ");
        }
        // 552, 1
        else if (nDims == 2 )
        {
          // 552, 23
          jamonWriter.write("(");
          // 553, 2
          {
            // 553, 2
            __jamon_innerUnit____baseaddr(jamonWriter, r );
          }
          // 553, 25
          jamonWriter.write(" + ");
          // 553, 28
          {
            // 553, 28
            __jamon_innerUnit____strfaddr(jamonWriter, r.getAddressOffset() );
          }
          // 553, 73
          jamonWriter.write(" + ");
          // 554, 3
          {
            // 554, 3
            __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace1() );
          }
          // 554, 46
          jamonWriter.write(" * (");
          // 555, 2
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(FV_PERL_INDEX[1]), jamonWriter);
          // 555, 24
          jamonWriter.write(" - ");
          // 555, 27
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry1()), jamonWriter);
          // 555, 50
          jamonWriter.write(") + ");
          // 556, 3
          {
            // 556, 3
            __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace() );
          }
          // 556, 45
          jamonWriter.write(" * (");
          // 557, 2
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(FV_PERL_INDEX[2]), jamonWriter);
          // 557, 24
          jamonWriter.write(" - ");
          // 557, 27
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry()), jamonWriter);
          // 557, 49
          jamonWriter.write(")");
          // 558, 1
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(woffset), jamonWriter);
          // 558, 14
          jamonWriter.write("); ");
        }
        // 559, 1
        else if (nDims == 3 )
        {
          // 559, 23
          jamonWriter.write("(");
          // 560, 2
          {
            // 560, 2
            __jamon_innerUnit____baseaddr(jamonWriter, r );
          }
          // 560, 25
          jamonWriter.write(" + ");
          // 560, 28
          {
            // 560, 28
            __jamon_innerUnit____strfaddr(jamonWriter, r.getAddressOffset() );
          }
          // 560, 73
          jamonWriter.write(" + ");
          // 561, 3
          {
            // 561, 3
            __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace2() );
          }
          // 561, 46
          jamonWriter.write(" * (");
          // 562, 2
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(FV_PERL_INDEX[0]), jamonWriter);
          // 562, 24
          jamonWriter.write(" - ");
          // 562, 27
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry2()), jamonWriter);
          // 562, 50
          jamonWriter.write(") + ");
          // 563, 3
          {
            // 563, 3
            __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace1() );
          }
          // 563, 46
          jamonWriter.write(" * (");
          // 564, 2
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(FV_PERL_INDEX[1]), jamonWriter);
          // 564, 24
          jamonWriter.write(" - ");
          // 564, 27
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry1()), jamonWriter);
          // 564, 50
          jamonWriter.write(") + ");
          // 565, 3
          {
            // 565, 3
            __jamon_innerUnit____strfaddr(jamonWriter, r.getEntrySpace() );
          }
          // 565, 45
          jamonWriter.write(" * (");
          // 566, 2
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(FV_PERL_INDEX[2]), jamonWriter);
          // 566, 24
          jamonWriter.write(" - ");
          // 566, 27
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getBaseEntry()), jamonWriter);
          // 566, 49
          jamonWriter.write(")");
          // 567, 1
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(woffset), jamonWriter);
          // 567, 14
          jamonWriter.write("); ");
        }
        // 568, 1
        else
        {
          // 569, 1
          
throw new Error(nDims + "-dimensional registers not supported");

        }
        // 572, 7
        jamonWriter.write("# ");
        // 573, 3
        {
          // 573, 3
          __jamon_innerUnit____strfaddr(jamonWriter, r.getAddress() );
        }
        // 573, 42
        jamonWriter.write("\n}\n\n");
        // 576, 1
        if (r.getNumEntries() > 1 )
        {
          // 576, 30
          jamonWriter.write("sub ");
          // 577, 5
          {
            // 577, 5
            __jamon_innerUnit____strfname(jamonWriter, r.getName(), "_ENTRIES" + (md ? "_0" : "") );
          }
          // 577, 81
          jamonWriter.write("\n{\n    _validatePrototype(@_, 1");
          // 579, 29
          if (testpoint )
          {
            // 579, 46
            jamonWriter.write(", -1");
          }
          // 579, 56
          jamonWriter.write(");\n    my ($self) = @_;\n    return ");
          // 581, 12
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getNumEntries()), jamonWriter);
          // 581, 35
          jamonWriter.write(";\n}\n\n");
        }
        // 585, 1
        if (r.getNumEntries1() > 1 )
        {
          // 585, 31
          jamonWriter.write("sub ");
          // 586, 5
          {
            // 586, 5
            __jamon_innerUnit____strfname(jamonWriter, r.getName(), "_ENTRIES_1" );
          }
          // 586, 64
          jamonWriter.write("\n{\n    _validatePrototype(@_, 1");
          // 588, 29
          if (testpoint )
          {
            // 588, 46
            jamonWriter.write(", -1");
          }
          // 588, 56
          jamonWriter.write(");\n    my ($self) = @_;\n    return ");
          // 590, 12
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getNumEntries1()), jamonWriter);
          // 590, 36
          jamonWriter.write(";\n}\n\n");
        }
        // 594, 1
        if (r.getNumEntries2() > 1 )
        {
          // 594, 31
          jamonWriter.write("sub ");
          // 595, 5
          {
            // 595, 5
            __jamon_innerUnit____strfname(jamonWriter, r.getName(), "_ENTRIES_2" );
          }
          // 595, 64
          jamonWriter.write(" {\n    _validatePrototype(@_, 1");
          // 597, 29
          if (testpoint )
          {
            // 597, 46
            jamonWriter.write(", -1");
          }
          // 597, 56
          jamonWriter.write(");\n    my ($self) = @_;\n    return ");
          // 599, 12
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getNumEntries2()), jamonWriter);
          // 599, 36
          jamonWriter.write(";\n}\n\n");
        }
        // 602, 7
        jamonWriter.write("sub ");
        // 603, 5
        {
          // 603, 5
          __jamon_innerUnit____strfname(jamonWriter, r.getName(), "_DEFAULT" );
        }
        // 603, 62
        jamonWriter.write("\n{\n");
        // 605, 1
        {
          // 605, 1
          __jamon_innerUnit____preamble(jamonWriter, r, nDims );
        }
        // 606, 1
        if (r.getNumDefaults() == 1 )
        {
          // 607, 1
          {
            // 607, 1
            __jamon_innerUnit____default(jamonWriter, r, 0 );
          }
        }
        // 608, 1
        else
        {
          // 609, 1
          for (int i = 0; i < r.getNumDefaults(); i++ )
          {
            // 609, 48
            jamonWriter.write("    if (");
            // 610, 9
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(FV_PERL_INDEX[2]), jamonWriter);
            // 610, 31
            jamonWriter.write(" == ");
            // 610, 35
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(i), jamonWriter);
            // 610, 42
            jamonWriter.write(")\n    {\n        ");
            // 612, 9
            {
              // 612, 9
              __jamon_innerUnit____default(jamonWriter, r, i );
            }
            // 612, 38
            jamonWriter.write("\n    }\n");
          }
        }
        // 615, 7
        jamonWriter.write("}\n\n");
      }
    }
    // 619, 8
    jamonWriter.write("1;\n");
  }
  
  
  // 286, 1
  private void __jamon_innerUnit____xdisplay(final java.io.Writer jamonWriter, final Integer i, final int w)
    throws java.io.IOException
  {
    // 291, 1
    
int nibbles = (int) Math.ceil(w / 4.0);

    // 294, 1
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format(String.format("0x%%0%dX", nibbles), i)), jamonWriter);
  }
  
  
  // 157, 1
  private void __jamon_innerUnit____strfaddr(final java.io.Writer jamonWriter, final int addr)
    throws java.io.IOException
  {
    // 161, 1
    {
      // 161, 1
      __jamon_innerUnit____xdisplay(jamonWriter, addr, 24 );
    }
  }
  
  
  // 199, 1
  private void __jamon_innerUnit____stride(final java.io.Writer jamonWriter, final Register r)
    throws java.io.IOException
  {
    // 203, 1
    
boolean md = r.getNumEntries1() > 1;

    // 206, 1
    if (r.getNumEntries() > 1 )
    {
      // 206, 30
      jamonWriter.write("our $");
      // 207, 6
      {
        // 207, 6
        __jamon_innerUnit____wstrfname(jamonWriter, r.getName(), "_STRIDE" + (md ? "_0" : "") , FV_PERL_WIDTH);
      }
      // 207, 82
      jamonWriter.write(" = ");
      // 208, 1
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getEntrySpace()), jamonWriter);
      // 208, 24
      jamonWriter.write(";\n");
    }
    // 210, 1
    if (r.getNumEntries1() > 1 )
    {
      // 210, 31
      jamonWriter.write("our $");
      // 211, 6
      {
        // 211, 6
        __jamon_innerUnit____wstrfname(jamonWriter, r.getName(), "_STRIDE_1" , FV_PERL_WIDTH);
      }
      // 211, 65
      jamonWriter.write(" = ");
      // 212, 1
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getEntrySpace1()), jamonWriter);
      // 212, 25
      jamonWriter.write(";\n");
    }
    // 214, 1
    if (r.getNumEntries2() > 1 )
    {
      // 214, 31
      jamonWriter.write("our $");
      // 215, 6
      {
        // 215, 6
        __jamon_innerUnit____wstrfname(jamonWriter, r.getName(), "_STRIDE_2" , FV_PERL_WIDTH);
      }
      // 215, 65
      jamonWriter.write(" = ");
      // 216, 1
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getEntrySpace2()), jamonWriter);
      // 216, 25
      jamonWriter.write(";\n");
    }
  }
  
  
  // 38, 1
  private void __jamon_innerUnit____baseaddr(final java.io.Writer jamonWriter, final Register r)
    throws java.io.IOException
  {
    // 42, 1
    jamonWriter.write("$");
    // 42, 2
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(prefix + r.getBaseName()), jamonWriter);
  }
  
  
  // 122, 1
  private void __jamon_innerUnit____preamble(final java.io.Writer jamonWriter, final Register r, final int nDims)
    throws java.io.IOException
  {
    // 127, 1
    
String word = r.getEntryWidth() > 1 ? ", " + FV_PERL_INDEX[3] : "";
int w = r.getEntryWidth() > 1 ? 1 : 0;

    // 131, 1
    if (nDims <= 3 )
    {
      // 131, 19
      jamonWriter.write("    _validatePrototype(@_, ");
      // 132, 28
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(1 + nDims + w), jamonWriter);
      // 132, 47
      if (testpoint )
      {
        // 132, 64
        jamonWriter.write(", -1");
      }
      // 132, 74
      jamonWriter.write(");\n    my ($self");
      // 134, 1
      for (int i = 0, j = 3 - nDims; i < nDims; i++, j++ )
      {
        // 134, 55
        jamonWriter.write(", ");
        // 135, 3
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(FV_PERL_INDEX[j]), jamonWriter);
      }
      // 137, 1
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(word), jamonWriter);
      // 137, 11
      jamonWriter.write(") = @_;\n");
    }
    // 138, 1
    else
    {
      // 139, 1
      
throw new Error(nDims + "-dimensional registers not supported");

    }
  }
  
  
  // 262, 1
  private void __jamon_innerUnit____wstrfname(final java.io.Writer jamonWriter, final String name, final String suffix, final int w)
    throws java.io.IOException
  {
    // 268, 1
    
String format = w >= 0 ? String.format("%%-%ds", w) : "%s";

    // 271, 1
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format(format, prefix + name + suffix)), jamonWriter);
  }
  
  
  // 60, 1
  private void __jamon_innerUnit____default(final java.io.Writer jamonWriter, final Register r, final int i)
    throws java.io.IOException
  {
    // 65, 1
    if (r.getEntryWidth() == 1 )
    {
      // 65, 31
      jamonWriter.write("    return ");
      // 66, 12
      {
        // 66, 12
        __jamon_innerUnit____xdisplay(jamonWriter, r.getDefault(i, 0), 32 );
      }
      // 66, 60
      jamonWriter.write(";\n");
    }
    // 67, 1
    else
    {
      // 68, 1
      for (int j = 0; j < r.getEntryWidth(); j++ )
      {
        // 68, 47
        jamonWriter.write("    return ");
        // 69, 12
        {
          // 69, 12
          __jamon_innerUnit____xdisplay(jamonWriter, r.getDefault(i, j), 32 );
        }
        // 69, 60
        jamonWriter.write(" if (");
        // 70, 5
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(FV_PERL_INDEX[3]), jamonWriter);
        // 70, 27
        jamonWriter.write(" == ");
        // 70, 31
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(j), jamonWriter);
        // 70, 38
        jamonWriter.write(");\n");
      }
      // 71, 8
      jamonWriter.write("    return undef;\n");
    }
  }
  
  
  // 91, 1
  private void __jamon_innerUnit____fields(final java.io.Writer jamonWriter, final RegisterStruct r)
    throws java.io.IOException
  {
    // 95, 1
    for (RegisterField f : r.fields.values() )
    {
      // 96, 1
      if (f.len == 1 )
      {
        // 96, 19
        jamonWriter.write("our $");
        // 97, 6
        {
          // 97, 6
          __jamon_innerUnit____wstrfname(jamonWriter, r.getName(), "_b_" + f.desc , FV_PERL_WIDTH);
        }
        // 97, 68
        jamonWriter.write(" = ");
        // 98, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.pos), jamonWriter);
        // 98, 12
        jamonWriter.write(";\n");
      }
      // 99, 1
      else
      {
        // 99, 8
        jamonWriter.write("our $");
        // 100, 6
        {
          // 100, 6
          __jamon_innerUnit____wstrfname(jamonWriter, r.getName(), "_l_" + f.desc , FV_PERL_WIDTH);
        }
        // 100, 68
        jamonWriter.write(" = ");
        // 101, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.pos), jamonWriter);
        // 101, 12
        jamonWriter.write(";\nour $");
        // 102, 6
        {
          // 102, 6
          __jamon_innerUnit____wstrfname(jamonWriter, r.getName(), "_h_" + f.desc , FV_PERL_WIDTH);
        }
        // 102, 68
        jamonWriter.write(" = ");
        // 103, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(f.pos + f.len - 1), jamonWriter);
        // 103, 24
        jamonWriter.write(";\n");
      }
    }
  }
  
  
  // 234, 1
  private void __jamon_innerUnit____width(final java.io.Writer jamonWriter, final RegisterStruct r)
    throws java.io.IOException
  {
    // 238, 1
    jamonWriter.write("our $");
    // 238, 6
    {
      // 238, 6
      __jamon_innerUnit____wstrfname(jamonWriter, r.getName(), "_WIDTH" , FV_PERL_WIDTH);
    }
    // 238, 62
    jamonWriter.write(" = ");
    // 239, 1
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getEntryWidth()), jamonWriter);
    // 239, 24
    jamonWriter.write(";\nour $");
    // 240, 6
    {
      // 240, 6
      __jamon_innerUnit____wstrfname(jamonWriter, r.getName(), "_BITS" , FV_PERL_WIDTH);
    }
    // 240, 61
    jamonWriter.write(" = ");
    // 241, 1
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(r.getNumberFieldBits()), jamonWriter);
    // 241, 29
    jamonWriter.write(";\n");
  }
  
  
  // 178, 1
  private void __jamon_innerUnit____strfname(final java.io.Writer jamonWriter, final String name, final String suffix)
    throws java.io.IOException
  {
    // 183, 1
    {
      // 183, 1
      __jamon_innerUnit____wstrfname(jamonWriter, name, suffix, -1 );
    }
  }
  
  
}
