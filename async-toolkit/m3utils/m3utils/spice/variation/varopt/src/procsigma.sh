#!/bin/sh -x

# usage: $0 <run_*_sigma dir names>

dirs=$*

root=`pwd`

VARDATA=${root}/vardata.sp

rm -f ${VARDATA}
touch ${VARDATA}

echo "* generated by $0" >> ${VARDATA}
echo "* `date`"          >> ${VARDATA}
echo "* root = ${root}"  >> ${VARDATA}


for dir in $dirs; do
    pushd $dir
    for subdir in [0-9]p*_*; do
        pushd $subdir

        echo in `pwd`

        compres=`cat */compres.dat | sort -nr | tail -1`
        echo $compres

        worst=`echo $compres | awk '{print $3}'`

        echo "* `pwd`" >> ${VARDATA}
        
        gzcat ../../${worst}/var.sp.gz | sed "s/data extern_data/data extern_data_${dir}_${subdir}/" >> ${VARDATA}

        echo "" >> ${VARDATA}
        
        popd
    done
    popd
done
