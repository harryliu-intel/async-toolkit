// Autogenerated Jamon implementation
// /nfs/sc/proj/ctg/mrl108/rliu68/sw-intel5/cad/java/src/./com/fulcrummicro/hw/verification/chip/mgmt/registers/templates/RDL.jamon

package com.fulcrummicro.hw.verification.chip.mgmt.registers.templates;

// 3, 1
import java.lang.Integer;
// 4, 1
import java.util.Collection;
// 5, 1
import com.fulcrummicro.hw.verification.lib.bitarray.LittleEndianBitArray;
// 6, 1
import com.fulcrummicro.util.misc.Utility;
// 7, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.*;
// 8, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnum;
// 9, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnumValue;

public class RDLImpl
  extends com.fulcrummicro.util.jamon.timestampImpl
  implements com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.RDL.Intf

{
  private final Collection<RegisterBase> bases;
  private final Collection<Register> regs;
  protected static com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.RDL.ImplData __jamon_setOptionalArguments(com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.RDL.ImplData p_implData)
  {
    com.fulcrummicro.util.jamon.timestampImpl.__jamon_setOptionalArguments(p_implData);
    return p_implData;
  }
  public RDLImpl(org.jamon.TemplateManager p_templateManager, com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.RDL.ImplData p_implData)
  {
    super(p_templateManager, __jamon_setOptionalArguments(p_implData));
    bases = p_implData.getBases();
    regs = p_implData.getRegs();
  }
  
  @Override protected void child_render_1(final java.io.Writer jamonWriter)
    throws java.io.IOException
  {
    // 15, 1
    jamonWriter.write("// INTEL TOP SECRET\n// Copyright ");
    // 16, 14
    {
      // 16, 14
      __jamon_innerUnit__copyright_year(jamonWriter, __jamon__get_Method_Opt_creationYear_default());
    }
    // 16, 35
    jamonWriter.write(" Intel Corporation. All Rights Reserved.\n//\n`include \"lib_udp.rdl\"\n\n");
    // 20, 1
    for (RegisterBase base : bases )
    {
      // 21, 1
      for (ConstantsEnum e : base.getEnums() )
      {
        // 22, 1
        {
          // 22, 1
          __jamon_innerUnit__enum(jamonWriter, e);
        }
        // 22, 17
        jamonWriter.write("\n");
      }
      // 25, 1
      for (Register reg : base.getRegisters() )
      {
        // 26, 1
        for (RegisterField field : reg.getSortedFields() )
        {
          // 27, 1
          if ((field.typedef != null) && !base.getEnums().contains(field.typedef) && (field.currentEntry == field.baseEntry) && !field.typedef.checkForDuplicateValues(null) )
          {
            // 28, 1
            {
              // 28, 1
              __jamon_innerUnit__enum(jamonWriter, field.typedef);
            }
          }
        }
      }
    }
    // 32, 8
    jamonWriter.write("\n");
    // 34, 1
    for (Register reg : regs )
    {
      // 35, 1
      int regwidth = (int)Math.pow(2, Util.log2(reg.getEntryWidth() * 32)); 
      // 36, 1
      jamonWriter.write("reg ");
      // 36, 5
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
      // 36, 38
      jamonWriter.write("_r {\n");
      // 37, 1
      if (reg.briefDescription != null )
      {
        // 37, 37
        jamonWriter.write("  name = \"");
        // 38, 11
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.escapeRdlDesc(reg.briefDescription)), jamonWriter);
        // 38, 57
        jamonWriter.write("\";\n");
      }
      // 39, 7
      jamonWriter.write("  desc = \"");
      // 40, 11
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.escapeRdlDesc(reg.description)), jamonWriter);
      // 40, 52
      jamonWriter.write("\";\n  regwidth = ");
      // 41, 14
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(regwidth), jamonWriter);
      // 41, 28
      jamonWriter.write(";\n  accesswidth = ");
      // 42, 17
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getAtomicWidth() * 32), jamonWriter);
      // 42, 48
      jamonWriter.write(";\n");
      // 43, 1
      for (RegisterField field : reg.getSortedFields(true, false, true, false) )
      {
        // 43, 77
        jamonWriter.write("  field {\n");
        // 45, 1
        if (field.typedef != null )
        {
          // 45, 30
          jamonWriter.write("    encode = ");
          // 46, 14
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.typedef.getVerilogName()), jamonWriter);
          // 46, 50
          jamonWriter.write("_enum;\n");
        }
        // 47, 7
        jamonWriter.write("    AccessType = \"");
        // 48, 19
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.type.toSystemRdlType()), jamonWriter);
        // 48, 53
        if (field.isVolatile() )
        {
          // 48, 79
          jamonWriter.write("/V");
        }
        // 48, 87
        jamonWriter.write("\";\n    desc = \"");
        // 49, 13
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.escapeRdlDesc(field.fullDescription)), jamonWriter);
        // 49, 60
        jamonWriter.write("\";\n");
        // 50, 1
        if (field.type != RegisterType.RO )
        {
          // 50, 38
          jamonWriter.write("    ValRandomize = true;\n");
        }
        // 52, 7
        jamonWriter.write("  } ");
        // 53, 5
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.desc), jamonWriter);
        // 53, 21
        jamonWriter.write("[");
        // 53, 22
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.pos + field.len - 1), jamonWriter);
        // 53, 53
        jamonWriter.write(":");
        // 53, 54
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.pos), jamonWriter);
        // 53, 69
        jamonWriter.write("] = ");
        // 54, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.len), jamonWriter);
        // 54, 16
        jamonWriter.write("'h0");
        // 55, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(new LittleEndianBitArray(regwidth+1,reg.getDefault(0)).getSlice(field.pos, field.len)), jamonWriter);
        // 55, 92
        jamonWriter.write(";\n");
      }
      // 56, 8
      jamonWriter.write("};\n");
      // 58, 1
      if (reg.getNumEntries1() > 1 )
      {
        // 58, 33
        jamonWriter.write("regfile ");
        // 59, 9
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
        // 59, 42
        jamonWriter.write("_rf {\n  ");
        // 60, 3
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
        // 60, 36
        jamonWriter.write("_r ");
        // 60, 39
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
        // 60, 58
        jamonWriter.write("[");
        // 60, 59
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries()), jamonWriter);
        // 60, 84
        jamonWriter.write("] += ");
        // 60, 89
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getEntrySpace() * 4), jamonWriter);
        // 60, 118
        jamonWriter.write(";\n};\n");
      }
      // 62, 7
      jamonWriter.write("\n");
    }
    // 64, 8
    jamonWriter.write("\n");
    // 66, 1
    for (RegisterBase base : bases )
    {
      // 66, 35
      jamonWriter.write("addrmap ");
      // 67, 9
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(base.getName()), jamonWriter);
      // 67, 29
      jamonWriter.write("_map {\n  name = \"");
      // 68, 11
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(base.getName()), jamonWriter);
      // 68, 31
      jamonWriter.write("\";\n  desc = \"\";\n  addressing = fullalign;\n  Space = \"MEM\";\n  \n");
      // 73, 1
      for (Register reg : base.getRegisters() )
      {
        // 74, 1
        if (reg.getAlias() == null )
        {
          // 75, 1
          if (reg.getNumEntries1() > 1 )
          {
            // 75, 33
            jamonWriter.write("  ");
            // 76, 3
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 76, 36
            jamonWriter.write("_rf ");
            // 76, 40
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 76, 59
            jamonWriter.write("[");
            // 76, 60
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries1()), jamonWriter);
            // 76, 86
            jamonWriter.write("] @0x");
            // 77, 5
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%05X", reg.getAddressOffset()*4)), jamonWriter);
            // 77, 58
            jamonWriter.write(" += ");
            // 78, 5
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getEntrySpace1() * 4), jamonWriter);
            // 78, 35
            jamonWriter.write("; // [");
            // 79, 6
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries()), jamonWriter);
            // 79, 31
            jamonWriter.write("]\n");
          }
          // 80, 1
          else
          {
            // 80, 8
            jamonWriter.write("  ");
            // 81, 3
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 81, 36
            jamonWriter.write("_r ");
            // 81, 39
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 82, 1
            if (reg.getNumEntries() > 1 )
            {
              // 82, 32
              jamonWriter.write("[");
              // 83, 2
              org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries()), jamonWriter);
              // 83, 27
              jamonWriter.write("]");
            }
            // 84, 7
            jamonWriter.write(" @0x");
            // 85, 5
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%05X", reg.getAddressOffset()*4)), jamonWriter);
            // 86, 1
            if (reg.getNumEntries() > 1 )
            {
              // 86, 32
              jamonWriter.write(" += ");
              // 87, 5
              org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getEntrySpace() * 4), jamonWriter);
            }
            // 88, 7
            jamonWriter.write(";\n");
          }
        }
      }
      // 91, 8
      jamonWriter.write("};\n\n");
    }
  }
  
  
  // 96, 1
  private void __jamon_innerUnit__enum(final java.io.Writer jamonWriter, final ConstantsEnum e)
    throws java.io.IOException
  {
    // 97, 32
    jamonWriter.write("  // Enum: ");
    // 98, 12
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getName()), jamonWriter);
    // 98, 29
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getCastDescription()), jamonWriter);
    // 98, 57
    jamonWriter.write("\nenum ");
    // 99, 6
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getVerilogName()), jamonWriter);
    // 99, 30
    jamonWriter.write("_enum {\n");
    // 100, 1
    for (ConstantsEnumValue c : e.values )
    {
      // 101, 1
      String name = c.getName();
if(name.matches("^[0-9].*")) { name = "_" + name;}

      // 104, 3
      jamonWriter.write("  ");
      // 105, 3
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%-20s", name)), jamonWriter);
      // 105, 37
      jamonWriter.write(" = ");
      // 105, 40
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%5s", c.getVerilogEncoding())), jamonWriter);
      // 105, 90
      jamonWriter.write(" { desc = \"");
      // 105, 101
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.escapeRdlDesc(c.getDescription())), jamonWriter);
      // 105, 145
      jamonWriter.write("\"; };\n");
    }
    // 106, 8
    jamonWriter.write("};\n");
  }
  
  
}
