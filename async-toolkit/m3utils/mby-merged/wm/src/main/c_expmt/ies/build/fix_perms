#!/bin/sh

CPATH=$1
NFSPATH=/nfs/site/disks/sqa

echo Fixing permissions in $CPATH...
while [[ "$CPATH" != "" ]]; do
    if [[ "$CPATH" == "$NFSPATH" ]]; then
        break
    fi
    RESULT=`find $CPATH -maxdepth 0 -type d -not -perm -a+x`
    if [[ "$RESULT" != "" ]]; then
        # echo Permission errors found on path $CPATH...
        chmod ag+rx $CPATH
    fi
    CPATH=`echo $CPATH | sed -e 's/\(.*\)\/.*/\1/'`;
done

echo Fixed parent tree permissions, fixing descendant permissions...
# Extend perms from user perms to all and group
echo ...directories...
find $1 -type d -perm -u+x | xargs chmod ag+x
find $1 -type d -perm -u+r | xargs chmod ag+r
find $1 -type d -perm -u+w | xargs chmod ag+w
echo ...files...
find $1 -type f -perm -u+x | xargs chmod ag+x
find $1 -type f -perm -u+r | xargs chmod ag+r
find $1 -type f -perm -u+w | xargs chmod ag+w
