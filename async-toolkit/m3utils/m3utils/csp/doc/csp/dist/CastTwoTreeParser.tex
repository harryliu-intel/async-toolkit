% Copyright (c) 2025 Intel Corporation.  All rights reserved.  See the file COPYRIGHT for more information.
% SPDX-License-Identifier: Apache-2.0

\begin{longtable}[]{@{}l@{}}
\toprule
\endhead
\begin{minipage}[t]{0.97\columnwidth}\raggedright
Grammar CastTwoTreeParser\\
\href{http://www.ANTLR.org}{ANTLR}-generated HTML file from
CastTwoTree.g

Terence Parr, \href{http://www.magelang.com}{MageLang Institute}\\
ANTLR Version 2.7.5 (20050128); 1989-2005\strut
\end{minipage}\tabularnewline
\bottomrule
\end{longtable}

\begin{verbatim}

Definition of tree parser CastTwoTreeParser, which is a subclass of TreeParser.

    
    
goal
        :   compilationUnit EOF 
        ;
    
    
compilationUnit
        :   ( moduleDeclaration ) ( importDeclaration )* ( globalBodyStatement )* 
        ;
    
    
moduleDeclaration
        :                #( m:MODULE id:IDENT ) 
        ;
    
    
importDeclaration
        :                #( IMPORT id:IMPORT_IDENT ) 
        ;
    
    
globalBodyStatement
        :   bodyStatement 
        ;
    
    
bodyStatementList
        :                #( BODY_STATEMENT_LIST 
                              ( bodyStatementenv, globalP, cell, envContainer, 
                                paramEnv, prsEnv,
                                subcellsEnv, subtypesEnv )* ) 
        ;
    
    
bodyStatement
        :   prsBlock 
        |   subcellsBlock 
        |   cspBlock 
        |   envBlock 
        |   javaBlock 
        |   netlistBlock 
        |   directiveBlock 
        |   block 
        |   variableDeclarationStatement 
        |   loopStatement 
        |   ifStatement 
        |   assignmentStatement 
        |   subtypesBlock 
        |   verilogBlock 
        |   typeDeclaration 
        |   channelDeclaration 
        |   aliasDeclaration 
        ;
    
    
prsBlock
        :                #( prs:PRS ( FRAGMENT  isFragment=true;  | ) ) 
        ;
    
    
subcellsBlock
        :                #( subcells:SUBCELLS 
                            ( inline:INLINE | fragment:FRAGMENT | ) ) 
        ;
    
    
cspBlock
        :                #( csp:CSP 
          ( cspPortsenv, cell | ) ) 
        ;
    
    
envBlock
        :                #( ENV ( envNameBlocknamedEnvBindings )* ) 
        ;
    
    
javaBlock
        :   oldJavaBlock 
        |   newJavaBlock 
        ;
    
    
netlistBlock
        :                #( netlist:NETLIST 
          ) 
        ;
    
    
directiveBlock
        :                #( directive:DIRECTIVE 
          ) 
        ;
    
    
block
        :                #( BLOCK bodyStatementListenv, false, cell, 
                                 envContainer, paramEnv, prsEnv,
                                 subcellsEnv, subtypesEnv ) 
        ;
    
    
variableDeclarationStatement
        :                #( VAR_DECL id:IDENT    
                             ( INLINE  inlineP = true;  | ) ( FLATTEN  flattenP = true;  | ) typeenv, cell, envContainer, HierName.makeHierName(varName),
                globalP, inlineP, flattenP, id, LOCAL_VAR ( variableInitializerenv | ) ) 
        ;
    
    
loopStatement
        :                #( LOOP id:IDENT rangeenv, true slist:BODY_STATEMENT_LIST ) 
        ;
    
    
ifStatement
        :                #( IF expressionenv, false slist:BODY_STATEMENT_LIST ) 
        ;
    
    
assignmentStatement
        :                #( ASSIGN exprenv, false ( expressionenv, false  l.add(vv); eList.add(ee); )* ) 
        ;
    
    
subtypesBlock
        :   SUBTYPES 
        ;
    
    
verilogBlock
        :                #( VERILOG ( verilogNamedenv, vb )* ) 
        ;
    
    
typeDeclaration
        :                #( TYPE_DEFINITION id:IDENT ( m:FORMALS ( p:FORMALS ( implied:FORMALS | ) | ) | ) ( ATTRIBUTES  isAttributeCell = true;  ( inheritanceList1:INHERITANCE_LIST | ) | ( inheritanceList2:INHERITANCE_LIST | ) ( refinement:REFINEMENT | ) ) b:BLOCK ) 
        ;
    
    
channelDeclaration
        :                #( DEFCHAN name:IDENT ( metas:FORMALS ( netGroup:FORMALS | ) | ) ( inheritanceList:INHERITANCE_LIST | ) ( refinement:REFINEMENT | ) body:BODY_STATEMENT_LIST ) 
        ;
    
    
aliasDeclaration
        :                #( DEFALIAS name:IDENT ( metas:FORMALS | ) refinement:REFINEMENT ) 
        ;
    
    
type
        :                #( TYPE baseTypeenv, env, cell, envContainer, varName, globalP,
                             declKind == META_PARAM ( arraySelectorenv, declKind != LOCAL_VAR
                             ? (ParamTypeInterface) pb.getSecond()
                             : (ParamTypeInterface) null,
                            declKind == META_PARAM | ) ( setFinalWidthenv, pb, ps ) ) 
        ;
    
    
variableInitializer
        :                #( ASSIGN expressionenv, false ) 
        |                #( PORT_LIST expressionListenv, true ( expressionListenv, true  v = new TupleGroupValue((TupleValue)v, implied);  | ) ) 
        ;
    
    
expression
        :                #( EXPRESSION exprenv, anonymousAllowedP, deepP ) 
        ;
    
    
expressionList
        :                #( EXPRESSION_LIST ( expressionenv, anonymousAllowedP, deepP  l.add(ve);  | ( id:IDENT rangeenv, true expr:EXPRESSION_LIST ) 
            )* ) 
        ;
    
    
setFinalWidth
        :                #( errorAST:CHANNEL_WIDTH ( expressionenv,false |  channelWidthValue = null;  ) ) 
        ;
    
    
baseType
        :                #( USER_TYPE id:IDENT expressionListmetaEnv, false ) 
        |   primitiveType 
        ;
    
    
arraySelector
        :                #( arrayExpr:ARRAY_SUB ( Range r; rangeenv, false 
            )* ) 
        ;
    
    
primitiveType
        :   BOOL 
        |   INT 
        |   FLOAT 
        |   NODE 
        ;
    
    
channelBody
        :                #( BODY_STATEMENT_LIST ( channelStatementenv, cell, aliasesEnv )* ) 
        ;
    
    
channelStatement
        :   aliasBlock 
        |   assertBlock 
        |   directiveBlock 
        ;
    
    
aliasBlock
        :   ALIAS 
        ;
    
    
assertBlock
        :   ASSERT 
        ;
    
    
assertStatements
        :                #( BODY_STATEMENT_LIST ( assertStatementenv, cell )* ) 
        ;
    
    
assertStatement
        :   assertPrsStatement 
        |   assertExclStatement 
        |   assertLoopStatement 
        |   assertIfStatement 
        ;
    
    
assertPrsStatement
        :   prsExpression 
        ;
    
    
assertExclStatement
        :   (                    #( hi:EXCLHI assertExclNodesenv  ) 
            |                    #( lo:EXCLLO assertExclNodesenv  ) 
            |                    #( cc:EXCLCC assertExclNodesenv  ) 
            |                    #( nocc:NOCC assertExclNodesenv  ) 
            ) 
            
        ;
    
    
assertLoopStatement
        :                #( LOOP id:IDENT rangeenv, true assertList:BODY_STATEMENT_LIST ) 
        ;
    
    
assertIfStatement
        :                #( IF expressionenv, false assertList:BODY_STATEMENT_LIST ) 
        ;
    
    
prsExpression
        :                #( PRS_EXPRESSION exprenv, false, deepP ) 
        ;
    
    
assertExclNodes
        :   ( expr )+ 
        ;
    
    
expr
        :                #( o01:OR exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o02:AND exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o03:NOT exprenv, false, deepP ) 
        |                #( oXOR:XOR exprenv, false, deepP exprenv, false, deepP ) 
        |                #( oExp:EXP exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o04:PLUS exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o05:MINUS exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o06:TIMES exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o07:DIV exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o08:MOD exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o09:UNARY_PLUS exprenv, false, deepP ) 
        |                #( o10:UNARY_MINUS exprenv, false, deepP ) 
        |                #( o11:LT exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o12:LE exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o13:EQ exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o14:NE exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o15:GE exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o16:GT exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o17:FIELD_ACCESS exprenv, false, deepP fi:FIELD_IDENT ) 
        |                #( o18:ARRAY_ACCESS exprenv, false, deepP arraySelectorenv, null, false ) 
        |   IDENT 
            (   expressionList 
            |   
            ) 
            
        |   NUM_INT 
        |   NUM_HEX 
        |   NUM_REAL 
        |   TRUE 
        |   FALSE 
        |                #( o21:ARRAY expressionListenv, anonymousAllowedP ) 
        |                #( o22:PRS_AND exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o23:PRS_OR exprenv, false, deepP exprenv, false, deepP ) 
        |                #( o24:PRS_NOT exprenv, false, deepP ) 
        |                #( o25:LOOP_PRS_OR id2:IDENT rangeenv, true e2:PRS_EXPRESSION ) 
        |                #( o26:LOOP_PRS_AND id3:IDENT rangeenv, true e3:PRS_EXPRESSION ) 
        |                #( o27:LOOP_TIMES id4:IDENT rangeenv, true e4:EXPRESSION ) 
        |                #( o28:LOOP_PLUS id5:IDENT rangeenv, true e5:EXPRESSION ) 
        |                #( o28x:LOOP_XOR id6:IDENT rangeenv, true e6:EXPRESSION ) 
        |                #( o28o:LOOP_OR id7:IDENT rangeenv, true e7:EXPRESSION ) 
        |                #( o28a:LOOP_AND id8:IDENT rangeenv, true e8:EXPRESSION ) 
        |                #( o29:BOOL exprenv, false, deepP ) 
        |                #( o30:INT exprenv, false, deepP ) 
        |                #( o31:FLOAT exprenv, false, deepP ) 
        |                #( o32:NODE exprenv, false, deepP ) 
        |                #( o33:ALINT_FANIN alintFaninenv ) 
        ;
    
    
range
        :                #( RANGE expressionenv, false ( expressionenv, false | ) ) 
        ;
    
    
aliasStatements
        :                #( BODY_STATEMENT_LIST ( aliasStatementenv, chan, aliasesEnv )* ) 
        ;
    
    
aliasStatement
        :   variableDeclarationStatement 
        |   aliasIfStatement 
        |   aliasLoopStatement 
        ;
    
    
aliasIfStatement
        :                #( IF expressionenv, false aliasList:BODY_STATEMENT_LIST ) 
        ;
    
    
aliasLoopStatement
        :                #( LOOP id:IDENT rangeenv, true aliasList:BODY_STATEMENT_LIST ) 
        ;
    
    
metaParamList
        :   (                    #( f:FORMALS ( 
        
         metaParamenv, metaParams, tupleVal.accessTuple(i++) )* ) 
            |   
            ) 
            
        ;
    
    
metaParam
        :                #( VAR_DECL id:IDENT typeenv, null, null, HierName.makeHierName(id.getText()), false,
                false, false, id, META_PARAM ) 
        ;
    
    
portParamList
        :                #( FORMALS ( portParamenv, cell, portList, impliedPortParentNodes,
                             reverseDirection )* ) 
        ;
    
    
portParam
        :                #( VAR_DECL id:IDENT ( PLUS | ) ( MINUS | ) typeenv, cell, null, HierName.makeHierName(id.getText()), false,
                false, false, id, PORT_PARAM ( COLON id2:IDENT | ) ( envExtraPortIdentenv, buf | ) ) 
        ;
    
    
envExtraPortIdent
        :                #( id:IDENT 
          buf.append(id.getText());
       ) 
        |                #( FIELD_ACCESS envExtraPortIdentenv, buf fi:FIELD_IDENT ) 
        |                #( ARRAY_ACCESS envExtraPortIdentenv, buf   subtypesArraySelectorenv, buf  ) 
        ;
    
    
subtypesArraySelector
        :                #( ARRAY_SUB subtypesRangeenv, buf (   subtypesRangeenv, buf )* ) 
        ;
    
    
arrayAccessExpr
        :                #( o18:ARRAY_ACCESS exprenv, false arraySelectorenv, null, false ) 
        ;
    
    
alintFanin
        :   expr 
            (   NUM_INT 
            |   PLUS 
            |   MINUS 
            ) 
            
        ;
    
    
prsStatements
        :                #( BODY_STATEMENT_LIST ( prsStatementenv, cell )* ) 
        ;
    
    
prsStatement
        :   prsIfStatement 
        |   prsLoopStatement 
        |   prsAction 
        |   directiveBlock 
        |   variableDeclarationStatement 
        |   assignmentStatement 
        |   assertBlock 
        ;
    
    
prsIfStatement
        :                #( IF expressionenv, false prslist:BODY_STATEMENT_LIST ) 
        ;
    
    
prsLoopStatement
        :                #( LOOP id:IDENT rangeenv, true prslist:BODY_STATEMENT_LIST ) 
        ;
    
    
prsAction
        :   (                    #( ARROW prsActionBodyenv, cell, deepP ) 
            |                    #( celem:CELEM_ARROW prsActionBodyenv, cell, deepP ) 
            |                    #( comb:COMB_ARROW prsActionBodyenv, cell, deepP ) 
            ) 
            
        ;
    
    
prsActionBody
        :   (   ISOCHRONIC 
            |   
            ) 
            (   UNSTAB 
            |   METASTABLE 
            |   
            ) 
            (   TIMED 
                (   expression 
                    (   expression 
                    |   
                    ) 
                |   
                ) 
            |   
            ) 
            (   (   AFTER 
                |   AFTER_PS 
                ) 
                expression 
            |   
            ) 
            prsExpression expr 
            (   PLUS 
            |   MINUS 
            ) 
            
        ;
    
    
subcellsStatementsList
        :                #( BODY_STATEMENT_LIST subcellsStatementsenv, cell ) 
        ;
    
    
subcellsStatements
        :   ( subcellsStatement )* 
        ;
    
    
subcellsStatement
        :   variableDeclarationStatement 
        |   assignmentStatement 
        |   subcellsIfStatement 
        |   subcellsLoopStatement 
        |   assertBlock 
        |   directiveBlock 
        ;
    
    
subcellsIfStatement
        :                #( IF expressionenv, false subcellsList:BODY_STATEMENT_LIST ) 
        ;
    
    
subcellsLoopStatement
        :                #( LOOP id:IDENT rangeenv, true subcellsList:BODY_STATEMENT_LIST ) 
        ;
    
    
subtypesStatementsList
        :                #( BODY_STATEMENT_LIST subtypesStatementsenv, copied, cell ) 
        ;
    
    
subtypesStatements
        :   ( subtypesStatement )* 
        ;
    
    
subtypesStatement
        :   subtypesRefinement 
        |   subtypesIfStatement 
        |   subtypesLoopStatement 
        |   directiveBlock 
        ;
    
    
subtypesRefinement
        :                #( v:VAR_DECL ( inline:INLINE | ) subtypesIdentenv, copied, buf 
            typeenv, throwawayCell, null,
                         HierName.makeHierName("fake"),
                         false, false, false, null, LOCAL_VAR typeenv, throwawayCell, null,
                        HierName.makeHierName("fake"),
                        false, false, false, null, LOCAL_VAR ) 
        ;
    
    
subtypesIfStatement
        :                #( IF expressionenv, false subtypeStmts:BODY_STATEMENT_LIST ) 
        ;
    
    
subtypesLoopStatement
        :                #( LOOP id:IDENT rangeenv, true subtypeStmts:BODY_STATEMENT_LIST ) 
        ;
    
    
subtypesRange
        :   range 
        ;
    
    
subtypesIdent
        :                #( id:IDENT 
          final String s = id.getText();
          buf.append(s);

          next = new SimpleBinder(env, Symbol.create(s));
       ) 
        |                #( FIELD_ACCESS subtypesIdentenv, copied, buf fi:FIELD_IDENT ) 
        |                #( ARRAY_ACCESS subtypesIdentenv, copied, buf  buf.append('[');  subtypesArraySelectorenv, buf  buf.append(']');  ) 
        ;
    
    
cspPorts
        :                #( CSP_PORTS ( cspPortenv, cell )+ ) 
        ;
    
    
cspPort
        :   IDENT 
        ;
    
    
envNameBlock
        :                #( NAMED_ENV typeDeclarationnamedEnvBindings, true ) 
        ;
    
    
oldJavaBlock
        :                #( JAVA oldJavaStatementsenv, cell ) 
        ;
    
    
newJavaBlock
        :                #( j:NEW_JAVA newJavaStatements
           env,
           cell.getBlockInterface().iterator(BlockInterface.JAVA).next(),
           (JavaCoSimInfo) cell.getCoSimInfo(CoSimParameters.JAVA),
           isEnv
          ) 
        ;
    
    
newJavaStatements
        :                #( BODY_STATEMENT_LIST ( newJavaStatementenv, javaBlock, cosimInfo, isEnv )* ) 
        ;
    
    
newJavaStatement
        :   newJavaClassStatement 
        |   javaChannelStatement 
        |   directiveBlock 
        ;
    
    
newJavaClassStatement
        :                #( NEW_JAVA_CLASS className:IDENT ( javaClassMetaParametersenv | ) instanceName:IDENT ( javaClassParametersenv, channelAndNodeNames | ) ( javaClassInitializersenv | ) ) 
        ;
    
    
/**
 * Adds the channel to the environment and the cosimInfo.
 **/
javaChannelStatement
        :                #( CHANNEL id:IDENT ( arraySelectorenv, null, false | ) ( javaChannelTimingInfoenv | ) ) 
        ;
    
    
javaClassMetaParameters
        :                #( JAVA_CLASS_META_PARAMETERS ( javaClassMetaParameterenv  accum.add(metaParam);  )+ ) 
        ;
    
    
javaClassParameters
        :                #( JAVA_CLASS_PARAMETERS ( javaClassParameterenv  params.add(param);  )+ ) 
        ;
    
    
javaClassInitializers
        :   JAVA_CLASS_INITIALIZERS 
        ;
    
    
javaClassMetaParameter
        :                #( EXPRESSION exprenv, false 
             final String name;
             if (v.getInstanceName() == null)
                 name = null;
             else
                 name = v.getInstanceName().getAsString('.');
             metaParam = new MetaParamDefinition(
                     name,
                     ((MetaParamValueInterface) v).toMetaParam());
          ) 
        ;
    
    
javaClassParameter
        :                #( JAVA_CLASS_PARAMETER exprenv, false ( javaChannelTimingInfoenv | ) 
          ) 
        ;
    
    
javaChannelTimingInfo
        :                #( c:CHANNEL_TIMING_INFO exprenv, false ( 
          | exprenv, false exprenv, false exprenv, false exprenv, false 
          ) ) 
        ;
    
    
oldJavaStatements
        :                #( BODY_STATEMENT_LIST ( oldJavaStatementenv, cell )* ) 
        ;
    
    
oldJavaStatement
        :   oldJavaClassStatement 
        |   inputChannelStatement 
        |   outputChannelStatement 
        |   internalChannelStatement 
        ;
    
    
oldJavaClassStatement
        :                #( JAVACLASS cls:QuotedString ) 
        ;
    
    
inputChannelStatement
        :                #( INPUTCHAN cls:QuotedString ) 
        ;
    
    
outputChannelStatement
        :                #( OUTPUTCHAN cls:QuotedString ) 
        ;
    
    
internalChannelStatement
        :                #( INTERNALCHAN cls:QuotedString ) 
        ;
    
    
verilogNamed
        :   IDENT verilogStatements 
        ;
    
    
verilogStatements
        :                #( BODY_STATEMENT_LIST ( verilogStatementenv, nb )* ) 
        ;
    
    
verilogStatement
        :   IDENT 
            (   expressionList 
            |   
            ) 
            (   verilogParameters 
            |   
            ) 
            (   verilogFiles 
            |   
            ) 
            SEMI 
        |   verilogFiles SEMI 
        |   directiveBlock 
        ;
    
    
verilogParameters
        :   ( verilogParameter )+ 
        ;
    
    
verilogFiles
        :   ( QuotedString )+ 
        ;
    
    
verilogParameter
        :   verilogImplictParameter 
        |   verilogExplictParameter 
        ;
    
    
verilogImplictParameter
        :   expr 
        ;
    
    
verilogExplictParameter
        :   (   DOT_IDENT 
            |   ESCAPED_VERILOG_IDENT 
            ) 
            (   expr 
            |   
            ) 
            RPAREN 
        ;
    
    
partialExtract
        :   IDENT 
            (   expressionList 
            |   
            ) 
            ( 
                (   PLUS 
                |   MINUS 
                ) 
                (   PLUS 
                |   MINUS 
                |   
                ) 
                ( partialExtractExpr ) )* 
            (   IDENT 
                (   expressionList 
                |   
                ) 
            |   TIMES 
            |   
            ) 
            
        ;
    
    
partialExtractExpr
        :                #( FIELD_ACCESS partialExtractExprsb fi:FIELD_IDENT ) 
        |                #( ARRAY_ACCESS partialExtractExprsb  ) 
        |   IDENT 
        ;
    
    
partialExtractArraySelector
        :                #( arrayExpr:ARRAY_SUB partialExtractRangesb ( partialExtractRangesb )* ) 
        ;
    
    
partialExtractRange
        :                #( RANGE #( EXPRESSION n:NUM_INT   ) ) 
        ;
    
    
getHeaderAST
        :                #( VAR_DECL IDENT ( INLINE | ) ( FLATTEN | ) #( TYPE #( USER_TYPE id:IDENT metas:EXPRESSION_LIST ) ) ) 
        ;
    
    
getCellData
        :   IDENT 
            (   EXPRESSION_LIST 
            |   
            ) 
            (   IDENT 
                (   EXPRESSION_LIST 
                |   
                ) 
            |   
            ) 
            
        ;
\end{verbatim}
