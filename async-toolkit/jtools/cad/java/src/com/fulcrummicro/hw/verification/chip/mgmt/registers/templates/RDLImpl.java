// Autogenerated Jamon implementation
// /nfs/site/disks/wdisk.53/kedunckl/p4wd/reg-main-1/shared/java/src/./com/fulcrummicro/hw/verification/chip/mgmt/registers/templates/RDL.jamon

package com.fulcrummicro.hw.verification.chip.mgmt.registers.templates;

// 3, 1
import java.lang.Integer;
// 4, 1
import java.util.Collection;
// 5, 1
import com.fulcrummicro.hw.verification.lib.bitarray.LittleEndianBitArray;
// 7, 1
import com.fulcrummicro.util.misc.Utility;
// 8, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.*;
// 9, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnum;
// 10, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnumValue;

public class RDLImpl
  extends com.fulcrummicro.util.jamon.timestampImpl
  implements com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.RDL.Intf

{
  private final Collection<RegisterBase> bases;
  private final Collection<Register> regs;
  protected static com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.RDL.ImplData __jamon_setOptionalArguments(com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.RDL.ImplData p_implData)
  {
    com.fulcrummicro.util.jamon.timestampImpl.__jamon_setOptionalArguments(p_implData);
    return p_implData;
  }
  public RDLImpl(org.jamon.TemplateManager p_templateManager, com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.RDL.ImplData p_implData)
  {
    super(p_templateManager, __jamon_setOptionalArguments(p_implData));
    bases = p_implData.getBases();
    regs = p_implData.getRegs();
  }
  
  @Override protected void child_render_1(final java.io.Writer jamonWriter)
    throws java.io.IOException
  {
    // 16, 1
    jamonWriter.write("// INTEL TOP SECRET\n// Copyright ");
    // 17, 14
    {
      // 17, 14
      __jamon_innerUnit__copyright_year(jamonWriter, __jamon__get_Method_Opt_creationYear_default());
    }
    // 17, 35
    jamonWriter.write(" Intel Corporation. All Rights Reserved.\n//\n`include \"lib_udp.rdl\"\n\n");
    // 21, 1
    for (RegisterBase base : bases )
    {
      // 22, 1
      for (ConstantsEnum e : base.getEnums() )
      {
        // 23, 1
        {
          // 23, 1
          __jamon_innerUnit__enum(jamonWriter, e);
        }
        // 23, 17
        jamonWriter.write("\n");
      }
      // 26, 1
      for (Register reg : base.getRegisters() )
      {
        // 27, 1
        for (RegisterField field : reg.getSortedFields() )
        {
          // 28, 1
          if ((field.typedef != null) && !base.getEnums().contains(field.typedef) && (field.currentEntry == field.baseEntry) && !field.typedef.checkForDuplicateValues(null) )
          {
            // 29, 1
            {
              // 29, 1
              __jamon_innerUnit__enum(jamonWriter, field.typedef);
            }
          }
        }
      }
    }
    // 33, 8
    jamonWriter.write("\n");
    // 35, 1
    for (Register reg : regs )
    {
      // 36, 1
      int regwidth = (int)Math.pow(2, Util.log2(reg.getEntryWidth() * 32)); 
      // 37, 1
      jamonWriter.write("reg ");
      // 37, 5
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
      // 37, 38
      jamonWriter.write("_r {\n");
      // 38, 1
      if (reg.briefDescription != null )
      {
        // 38, 37
        jamonWriter.write("  name = \"");
        // 39, 11
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.escapeRdlDesc(reg.briefDescription)), jamonWriter);
        // 39, 57
        jamonWriter.write("\";\n");
      }
      // 40, 7
      jamonWriter.write("  desc = \"");
      // 41, 11
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.escapeRdlDesc(reg.description)), jamonWriter);
      // 41, 52
      jamonWriter.write("\";\n  regwidth = ");
      // 42, 14
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(regwidth), jamonWriter);
      // 42, 28
      jamonWriter.write(";\n  accesswidth = ");
      // 43, 17
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getAtomicWidth() * 32), jamonWriter);
      // 43, 48
      jamonWriter.write(";\n");
      // 44, 1
      for (RegisterField field : reg.getSortedFields(true, false, true, false) )
      {
        // 44, 77
        jamonWriter.write("  field {\n");
        // 46, 1
        if (field.typedef != null )
        {
          // 46, 30
          jamonWriter.write("    encode = ");
          // 47, 14
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.typedef.getVerilogName()), jamonWriter);
          // 47, 50
          jamonWriter.write("_enum;\n");
        }
        // 48, 7
        jamonWriter.write("    AccessType = \"");
        // 49, 19
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.type.toSystemRdlType()), jamonWriter);
        // 49, 53
        if (field.isVolatile() )
        {
          // 49, 79
          jamonWriter.write("/V");
        }
        // 49, 87
        jamonWriter.write("\";\n    desc = \"");
        // 50, 13
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.escapeRdlDesc(field.fullDescription)), jamonWriter);
        // 50, 60
        jamonWriter.write("\";\n");
        // 51, 1
        if (field.type != RegisterType.RO )
        {
          // 51, 38
          jamonWriter.write("    ValRandomize = true;\n");
        }
        // 53, 7
        jamonWriter.write("  } ");
        // 54, 5
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.desc), jamonWriter);
        // 54, 21
        jamonWriter.write("[");
        // 54, 22
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.pos + field.len - 1), jamonWriter);
        // 54, 53
        jamonWriter.write(":");
        // 54, 54
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.pos), jamonWriter);
        // 54, 69
        jamonWriter.write("] = ");
        // 55, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.len), jamonWriter);
        // 55, 16
        jamonWriter.write("'h0");
        // 56, 1
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(new LittleEndianBitArray(regwidth+1,reg.getDefault(0)).getSlice(field.pos, field.len)), jamonWriter);
        // 56, 92
        jamonWriter.write(";\n");
      }
      // 57, 8
      jamonWriter.write("};\n");
      // 59, 1
      if (reg.getNumEntries1() > 1 )
      {
        // 59, 33
        jamonWriter.write("regfile ");
        // 60, 9
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
        // 60, 42
        jamonWriter.write("_rf {\n  ");
        // 61, 3
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
        // 61, 36
        jamonWriter.write("_r ");
        // 61, 39
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
        // 61, 58
        jamonWriter.write("[");
        // 61, 59
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries()), jamonWriter);
        // 61, 84
        jamonWriter.write("] += ");
        // 61, 89
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getEntrySpace() * 4), jamonWriter);
        // 61, 118
        jamonWriter.write(";\n};\n");
      }
      // 63, 7
      jamonWriter.write("\n");
    }
    // 65, 8
    jamonWriter.write("\n");
    // 67, 1
    for (RegisterBase base : bases )
    {
      // 67, 35
      jamonWriter.write("addrmap ");
      // 68, 9
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(base.getName()), jamonWriter);
      // 68, 29
      jamonWriter.write("_map {\n  name = \"");
      // 69, 11
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(base.getName()), jamonWriter);
      // 69, 31
      jamonWriter.write("\";\n  desc = \"\";\n  addressing = fullalign;\n  Space = \"MEM\";\n  \n");
      // 74, 1
      for (Register reg : base.getRegisters() )
      {
        // 75, 1
        if (reg.getAlias() == null )
        {
          // 76, 1
          if (reg.getNumEntries1() > 1 )
          {
            // 76, 33
            jamonWriter.write("  ");
            // 77, 3
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 77, 36
            jamonWriter.write("_rf ");
            // 77, 40
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 77, 59
            jamonWriter.write("[");
            // 77, 60
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries1()), jamonWriter);
            // 77, 86
            jamonWriter.write("] @0x");
            // 78, 5
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%05X", reg.getAddressOffset()*4)), jamonWriter);
            // 78, 58
            jamonWriter.write(" += ");
            // 79, 5
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getEntrySpace1() * 4), jamonWriter);
            // 79, 35
            jamonWriter.write("; // [");
            // 80, 6
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries()), jamonWriter);
            // 80, 31
            jamonWriter.write("]\n");
          }
          // 81, 1
          else
          {
            // 81, 8
            jamonWriter.write("  ");
            // 82, 3
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 82, 36
            jamonWriter.write("_r ");
            // 82, 39
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 83, 1
            if (reg.getNumEntries() > 1 )
            {
              // 83, 32
              jamonWriter.write("[");
              // 84, 2
              org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries()), jamonWriter);
              // 84, 27
              jamonWriter.write("]");
            }
            // 85, 7
            jamonWriter.write(" @0x");
            // 86, 5
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%05X", reg.getAddressOffset()*4)), jamonWriter);
            // 87, 1
            if (reg.getNumEntries() > 1 )
            {
              // 87, 32
              jamonWriter.write(" += ");
              // 88, 5
              org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getEntrySpace() * 4), jamonWriter);
            }
            // 89, 7
            jamonWriter.write(";\n");
          }
        }
      }
      // 92, 8
      jamonWriter.write("};\n\n");
    }
  }
  
  
  // 97, 1
  private void __jamon_innerUnit__enum(final java.io.Writer jamonWriter, final ConstantsEnum e)
    throws java.io.IOException
  {
    // 98, 32
    jamonWriter.write("  // Enum: ");
    // 99, 12
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getName()), jamonWriter);
    // 99, 29
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getCastDescription()), jamonWriter);
    // 99, 57
    jamonWriter.write("\nenum ");
    // 100, 6
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getVerilogName()), jamonWriter);
    // 100, 30
    jamonWriter.write("_enum {\n");
    // 101, 1
    for (ConstantsEnumValue c : e.values )
    {
      // 102, 1
      String name = c.getName();
if(name.matches("^[0-9].*")) { name = "_" + name;}

      // 105, 3
      jamonWriter.write("  ");
      // 106, 3
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%-20s", name)), jamonWriter);
      // 106, 37
      jamonWriter.write(" = ");
      // 106, 40
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%5s", c.getVerilogEncoding())), jamonWriter);
      // 106, 90
      jamonWriter.write(" { desc = \"");
      // 106, 101
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.escapeRdlDesc(c.getDescription())), jamonWriter);
      // 106, 145
      jamonWriter.write("\"; };\n");
    }
    // 107, 8
    jamonWriter.write("};\n");
  }
  
  
}
