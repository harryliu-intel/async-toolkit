# vim:et:sw=4:ts=4:
# FocalPoint API src package
# Build Makefile

################################# Variables ##################################

# you must set platform
ifeq ($(PLATFORM),)
 $(error You must set the PLATFORM variable appropriately.)
endif

ifeq ($(PLATFORM_OS),)
    PLATFORM_OS = linux
endif


# generate build identifier fragment if needed
ifneq ($(SDK_BUILD_ID),)
    BUILD_ID_FRAG = -DFM_BUILD_IDENTIFIER=\"$(SDK_BUILD_ID)\"
endif

ifeq ($(PLATFORM_OS),linux)
    SO_EXTENSION = so
endif


#########################################
# Programs
#########################################

EGREP               = egrep
GAWK                = awk
GSED                = sed
P4                  = p4
SWIG                = swig
XMLLINT             = xmllint

#########################################
# Compilation Variables
#########################################

#
# Note: -Wno-missing-field-initializers is needed to prevent gcc from emitting
# a warning when using designator initializers on nested structs, which it
# shouldn't do according to the gcc documentation, but in fact does.
CWARNING_FLAGS = -Wno-long-long -Wextra -Wall -Werror -Wno-missing-field-initializers -Wno-unused

CPPFLAGS   = -D_GNU_SOURCE $(BUILD_ID_FRAG) -I../include -I../include/platforms -I../include/platforms/$(PLATFORM) -I../include/platforms/$(PLATFORM)/kernel -I../testing/include -I../include/alos -I../include/alos/$(PLATFORM_OS)
CFLAGS     = -std=c99 -g $(CWARNING_FLAGS) $(CPPFLAGS) -fPIC -Wno-variadic-macros
LFLAGS     = -lm -lpthread -ldl
LIBFLAGS   = -dynamiclib -shared -fPIC -lpthread
SHFLAGS    = -shared

