// Autogenerated Jamon implementation
// /nfs/site/disks/wdisk.55/rliu68/reg-rrc-1/shared/java/src/./com/fulcrummicro/hw/verification/chip/mgmt/registers/templates/VerilogStruct.jamon

package com.fulcrummicro.hw.verification.chip.mgmt.registers.templates;

// 3, 1
import java.util.Collection;
// 4, 1
import com.fulcrummicro.util.misc.Utility;
// 5, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.*;
// 6, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnum;
// 7, 1
import com.fulcrummicro.hw.verification.lib.constants.ConstantsEnumValue;

public class VerilogStructImpl
  extends com.fulcrummicro.util.jamon.timestampImpl
  implements com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.VerilogStruct.Intf

{
  private final Collection<RegisterBase> bases;
  private final Collection<Register> regs;
  private final Collection<ConstantsEnum> typedefs;
  private final boolean suppressTypedefEnums;
  protected static com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.VerilogStruct.ImplData __jamon_setOptionalArguments(com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.VerilogStruct.ImplData p_implData)
  {
    com.fulcrummicro.util.jamon.timestampImpl.__jamon_setOptionalArguments(p_implData);
    return p_implData;
  }
  public VerilogStructImpl(org.jamon.TemplateManager p_templateManager, com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.VerilogStruct.ImplData p_implData)
  {
    super(p_templateManager, __jamon_setOptionalArguments(p_implData));
    bases = p_implData.getBases();
    regs = p_implData.getRegs();
    typedefs = p_implData.getTypedefs();
    suppressTypedefEnums = p_implData.getSuppressTypedefEnums();
  }
  
  @Override protected void child_render_1(final java.io.Writer jamonWriter)
    throws java.io.IOException
  {
    // 15, 1
    jamonWriter.write("// INTEL TOP SECRET\n// Copyright ");
    // 16, 14
    {
      // 16, 14
      __jamon_innerUnit__copyright_year(jamonWriter, __jamon__get_Method_Opt_creationYear_default());
    }
    // 16, 35
    jamonWriter.write(" Intel Corporation. All Rights Reserved.\n//\n// THIS FILE IS AUTOMATICALLY GENERATED - DO NOT MODIFY.\n// Last Updated ");
    // 19, 17
    {
      // 19, 17
      __jamon_innerUnit__timestamp(jamonWriter);
    }
    // 19, 32
    jamonWriter.write("\n\n");
    // 21, 1
    for (RegisterBase base : bases )
    {
      // 21, 35
      jamonWriter.write("package ");
      // 22, 9
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(base.getName().toLowerCase()), jamonWriter);
      // 22, 43
      jamonWriter.write("_pkg; \n");
      // 24, 1
      for (ConstantsEnum e : base.getEnums() )
      {
        // 25, 1
        {
          // 25, 1
          __jamon_innerUnit__enum(jamonWriter, e, false);
        }
        // 25, 33
        jamonWriter.write("\n");
      }
      // 30, 1
      for (RegisterStruct rs : base.getStructs() )
      {
        // 30, 47
        jamonWriter.write("// Custom struct: ");
        // 31, 19
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(rs.getName()), jamonWriter);
        // 31, 37
        jamonWriter.write("\n");
        // 32, 1
        for (RegisterField field : rs.getSortedFields() )
        {
          // 33, 1
          if (!suppressTypedefEnums && (field.typedef != null) &&  !field.typedef.checkForDuplicateValues(null) )
          {
            // 34, 1
            {
              // 34, 1
              __jamon_innerUnit__enum(jamonWriter, field.typedef, false);
            }
          }
        }
        // 37, 1
        {
          // 37, 1
          __jamon_innerUnit__structure(jamonWriter, rs );
        }
        // 37, 23
        jamonWriter.write("\n");
      }
      // 40, 1
      for (Register reg : base.getRegisters() )
      {
        // 41, 1
        if (reg.getSortedFields().size() > 0 )
        {
          // 41, 41
          jamonWriter.write("// Register struct: ");
          // 42, 21
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
          // 42, 40
          jamonWriter.write("\n");
          // 43, 1
          
boolean bug23887 = reg.isImplementationTrue("bug23887-workaround");

          // 46, 1
          for (RegisterField field : reg.getSortedFields() )
          {
            // 47, 1
            if (!suppressTypedefEnums && (field.typedef != null) && !base.getEnums().contains(field.typedef) && (field.currentEntry == field.baseEntry) && !field.typedef.checkForDuplicateValues(null) )
            {
              // 48, 1
              {
                // 48, 1
                __jamon_innerUnit__enum(jamonWriter, field.typedef, bug23887);
              }
            }
          }
          // 51, 1
          {
            // 51, 1
            __jamon_innerUnit__structure(jamonWriter, reg );
          }
        }
        // 52, 7
        jamonWriter.write("\n");
      }
      // 54, 65
      jamonWriter.write("endpackage\n");
    }
    // 56, 56
    jamonWriter.write("\n");
  }
  
  
  // 58, 1
  private void __jamon_innerUnit__structure(final java.io.Writer jamonWriter, final RegisterStruct rs)
    throws java.io.IOException
  {
    // 59, 34
    jamonWriter.write("typedef struct packed {\n");
    // 61, 1
    if (rs.getSortedFields() != null )
    {
      // 62, 1
      if ((rs instanceof Register) && ( ((Register)rs).getImplementationWidth() > ((Register)rs).getNumberFieldBits() ) )
      {
        // 62, 118
        jamonWriter.write("  logic[");
        // 63, 9
        org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(((Register)rs).getImplementationWidth() - ((Register)rs).getNumberFieldBits() -1), jamonWriter);
        // 63, 95
        jamonWriter.write(":0] RESERVED_IMPLEMENTATION_BITS;\n");
      }
      // 65, 1
      for (RegisterField field : rs.getSortedFields(true) )
      {
        // 66, 1
        if (!suppressTypedefEnums && (field.typedef != null) && !field.typedef.checkForDuplicateValues(null) )
        {
          // 66, 105
          jamonWriter.write("  ");
          // 67, 3
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.typedef.getStructName()), jamonWriter);
          // 67, 38
          jamonWriter.write(" ");
          // 67, 39
          {
            // 67, 39
            __jamon_innerUnit__field_array(jamonWriter, field );
          }
          // 67, 68
          jamonWriter.write(" ");
          // 67, 69
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.getVerilogStructName()), jamonWriter);
          // 67, 103
          jamonWriter.write(";\n");
        }
        // 68, 1
        else
        {
          // 69, 1
          if (field.len == 1 )
          {
            // 69, 23
            jamonWriter.write("  logic ");
            // 70, 9
            {
              // 70, 9
              __jamon_innerUnit__field_array(jamonWriter, field );
            }
            // 70, 38
            jamonWriter.write("      ");
            // 70, 44
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.getVerilogStructName()), jamonWriter);
            // 70, 78
            jamonWriter.write(";\n");
          }
          // 71, 1
          else
          {
            // 71, 8
            jamonWriter.write("  logic ");
            // 72, 9
            {
              // 72, 9
              __jamon_innerUnit__field_array(jamonWriter, field );
            }
            // 72, 38
            jamonWriter.write("[");
            // 72, 39
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.len-1), jamonWriter);
            // 72, 56
            jamonWriter.write(":0] ");
            // 72, 60
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.getVerilogStructName()), jamonWriter);
            // 72, 94
            jamonWriter.write(";\n");
          }
        }
      }
    }
    // 76, 1
    else
    {
      // 76, 8
      jamonWriter.write("  // ERROR: field overlap\n");
    }
    // 78, 7
    jamonWriter.write("} ");
    // 79, 3
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(rs.getName().toLowerCase()), jamonWriter);
    // 79, 35
    jamonWriter.write("_t;\n");
  }
  
  
  // 82, 1
  private void __jamon_innerUnit__field_array(final java.io.Writer jamonWriter, final RegisterField field)
    throws java.io.IOException
  {
    // 84, 1
    if (field.entries>1 )
    {
      // 84, 24
      jamonWriter.write("[");
      // 84, 25
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.entries-1), jamonWriter);
      // 84, 46
      jamonWriter.write(":");
      // 84, 47
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(field.baseEntry), jamonWriter);
      // 84, 68
      jamonWriter.write("]");
    }
  }
  
  
  // 87, 1
  private void __jamon_innerUnit__enum(final java.io.Writer jamonWriter, final ConstantsEnum e, final boolean bug23887)
    throws java.io.IOException
  {
    // 88, 50
    jamonWriter.write("  // Enum: ");
    // 89, 12
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getName()), jamonWriter);
    // 89, 29
    jamonWriter.write("\n");
    // 90, 1
    if (e.getSize() == 1 && !bug23887 )
    {
      // 90, 38
      jamonWriter.write("  typedef enum logic {\n");
    }
    // 92, 1
    else
    {
      // 92, 8
      jamonWriter.write("  typedef enum logic [");
      // 93, 23
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getSize()-1), jamonWriter);
      // 93, 42
      jamonWriter.write(":0] {\n");
    }
    // 95, 1
    for (ConstantsEnumValue c : e.values )
    {
      // 95, 41
      jamonWriter.write("    ");
      // 96, 5
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%-20s", c.getVerilogName().toUpperCase())), jamonWriter);
      // 96, 67
      jamonWriter.write(" = ");
      // 96, 70
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("%5s", c.getVerilogEncoding())), jamonWriter);
      // 96, 120
      jamonWriter.write(",");
      // 96, 121
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(c.getCastDescription()), jamonWriter);
      // 96, 149
      jamonWriter.write("\n");
    }
    // 97, 8
    jamonWriter.write("    XPROP_");
    // 98, 11
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getVerilogName().toUpperCase()), jamonWriter);
    // 98, 49
    jamonWriter.write(" = ");
    // 98, 52
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getVerilogX()), jamonWriter);
    // 98, 73
    jamonWriter.write("\n  } ");
    // 99, 5
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getStructName()), jamonWriter);
    // 99, 28
    jamonWriter.write(";");
    // 99, 29
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(e.getCastDescription()), jamonWriter);
    // 99, 57
    jamonWriter.write("\n");
  }
  
  
}
