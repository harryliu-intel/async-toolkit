// Autogenerated Jamon implementation
// C:/Users/mhesseli/Documents/Perforce/rrc-4/reg-main/shared/java/src/./com/fulcrummicro/hw/verification/chip/mgmt/registers/templates/CastCommon.jamon

package com.fulcrummicro.hw.verification.chip.mgmt.registers.templates;

// 4, 1
import java.util.Collection;
// 5, 1
import com.fulcrummicro.util.misc.Utility;
// 6, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.Register;
// 7, 1
import com.fulcrummicro.hw.verification.chip.mgmt.registers.Util;

public abstract class CastCommonImpl
  extends com.fulcrummicro.util.jamon.timestampImpl
  implements com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.CastCommon.Intf

{
  protected static com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.CastCommon.ImplData __jamon_setOptionalArguments(com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.CastCommon.ImplData p_implData)
  {
    com.fulcrummicro.util.jamon.timestampImpl.__jamon_setOptionalArguments(p_implData);
    return p_implData;
  }
  public CastCommonImpl(org.jamon.TemplateManager p_templateManager, com.fulcrummicro.hw.verification.chip.mgmt.registers.templates.CastCommon.ImplData p_implData)
  {
    super(p_templateManager, __jamon_setOptionalArguments(p_implData));
  }
  
  @Override protected void child_render_1(final java.io.Writer jamonWriter)
    throws java.io.IOException
  {
    // 8, 11
    jamonWriter.write("/**\n * INTEL TOP SECRET\n * Copyright ");
    // 11, 14
    {
      // 11, 14
      __jamon_innerUnit__copyright_year(jamonWriter, __jamon__get_Method_Opt_creationYear_default());
    }
    // 11, 35
    jamonWriter.write(" Intel Corporation. All Rights Reserved.\n *\n * THIS FILE IS AUTOMATICALLY GENERATED - DO NOT MODIFY.\n * Last Updated ");
    // 14, 17
    {
      // 14, 17
      __jamon_innerUnit__timestamp(jamonWriter);
    }
    // 14, 33
    jamonWriter.write("\n */\n");
    child_render_2(jamonWriter);
  }
  
  protected abstract void child_render_2(final java.io.Writer jamonWriter) throws java.io.IOException;
  
  
  
  
  
  
  
  
  
  /**
   * @param jamonWriter
   * @throws java.io.IOException
   */
  // 43, 1
  protected void __jamon_innerUnit__registerStructureBaseReg(final java.io.Writer jamonWriter, final Register reg, final String namePrefix)
    throws java.io.IOException
  {
    // 48, 18
    if (reg.isStructure() )
    {
      // 48, 43
      jamonWriter.write("        ");
      // 49, 9
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Utility.underscoreToCamelCase(reg.getName(), true)), jamonWriter);
      // 49, 65
      jamonWriter.write("\n");
    }
    // 50, 18
    else
    {
      // 50, 25
      jamonWriter.write("        int(");
      // 51, 13
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
      // 51, 32
      jamonWriter.write("_BITS)\n");
    }
    // 53, 1
    String entriesPostfix = (reg.getNumEntries1() > 1) ? "_0" : ""; 
    // 53, 74
    jamonWriter.write("            ");
    // 54, 13
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf((namePrefix + reg.getName()).toLowerCase()), jamonWriter);
    // 55, 18
    if (reg.getNumEntries2() > 1 )
    {
      // 55, 50
      jamonWriter.write("[0..");
      // 55, 54
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
      // 55, 73
      jamonWriter.write("_ENTRIES_2-1]");
    }
    // 56, 18
    if (reg.getNumEntries1() > 1 )
    {
      // 56, 50
      jamonWriter.write("[0..");
      // 56, 54
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
      // 56, 73
      jamonWriter.write("_ENTRIES_1-1]");
    }
    // 57, 18
    if (reg.getNumEntries() > 1 )
    {
      // 57, 49
      jamonWriter.write("[0..");
      // 57, 53
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
      // 57, 72
      jamonWriter.write("_ENTRIES");
      // 57, 80
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(entriesPostfix), jamonWriter);
      // 57, 100
      jamonWriter.write("-1]");
    }
    // 57, 109
    jamonWriter.write(";\n");
  }
  
  protected String __jamon__get_Method_Opt_namePrefix_default()
  {
    return "";
  }
  
  /**
   * @param jamonWriter
   * @throws java.io.IOException
   */
  // 117, 1
  protected void __jamon_innerUnit__registerAddressGuardExpr(final java.io.Writer jamonWriter, final Register reg)
    throws java.io.IOException
  {
    // 121, 1
    int regBaseAddr = reg.getUnitBaseAddress() + reg.getAddressOffset();
Register.IndexInfo indexInfo = reg.getIndexInfo();

    // 125, 1
    jamonWriter.write("(( chip_addr & ");
    // 125, 16
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("0x%h", reg.getAddressMatchMask())), jamonWriter);
    // 125, 70
    jamonWriter.write(" ) == ");
    // 125, 76
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(String.format("0x%h",regBaseAddr)), jamonWriter);
    // 126, 1
    if (reg.getNumEntries() > 1 && !Util.isPowerOf2(reg.getNumEntries()) )
    {
      // 126, 73
      jamonWriter.write(" & (((chip_addr >> ");
      // 127, 20
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(indexInfo.entry0Idx), jamonWriter);
      // 127, 45
      jamonWriter.write(") & ");
      // 127, 49
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.expandToPowerOf2Mask(reg.getNumEntries())), jamonWriter);
      // 127, 101
      jamonWriter.write(") < ");
      // 127, 105
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries()), jamonWriter);
      // 127, 130
      jamonWriter.write(")");
    }
    // 129, 1
    if (reg.getNumEntries1() > 1 && !Util.isPowerOf2(reg.getNumEntries1()) )
    {
      // 129, 75
      jamonWriter.write(" & (((chip_addr >> ");
      // 130, 20
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(indexInfo.entry1Idx), jamonWriter);
      // 130, 45
      jamonWriter.write(") & ");
      // 130, 49
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.expandToPowerOf2Mask(reg.getNumEntries1())), jamonWriter);
      // 130, 102
      jamonWriter.write(") < ");
      // 130, 106
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries1()), jamonWriter);
      // 130, 132
      jamonWriter.write(")");
    }
    // 132, 1
    if (reg.getNumEntries2() > 1 && !Util.isPowerOf2(reg.getNumEntries2()) )
    {
      // 132, 75
      jamonWriter.write(" & (((chip_addr >> ");
      // 133, 20
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(indexInfo.entry2Idx), jamonWriter);
      // 133, 45
      jamonWriter.write(") & ");
      // 133, 49
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(Util.expandToPowerOf2Mask(reg.getNumEntries2())), jamonWriter);
      // 133, 102
      jamonWriter.write(") < ");
      // 133, 106
      org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getNumEntries2()), jamonWriter);
      // 133, 132
      jamonWriter.write(")");
    }
    // 134, 7
    jamonWriter.write(")");
  }
  
  
  /**
   * @param jamonWriter
   * @throws java.io.IOException
   */
  // 69, 1
  protected void __jamon_innerUnit__registerInitBase(final java.io.Writer jamonWriter, final Collection<Register> registers, final String camelCaseBaseName)
    throws java.io.IOException
  {
    // 73, 9
    jamonWriter.write("    function init");
    // 74, 18
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(camelCaseBaseName), jamonWriter);
    // 74, 41
    jamonWriter.write("Registers(");
    // 74, 51
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(camelCaseBaseName), jamonWriter);
    // 74, 74
    jamonWriter.write("Registers -+s) = (\n");
    // 75, 14
    for (Register reg : registers )
    {
      // 75, 47
      if (reg.getAlias() == null )
      {
        // 76, 18
        if (reg.getNumEntries() == 1 )
        {
          // 77, 22
          if (reg.isStructure() )
          {
            // 77, 47
            jamonWriter.write("      unpack(s::");
            // 78, 17
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 78, 50
            jamonWriter.write(", ");
            // 78, 52
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 78, 71
            jamonWriter.write("_DEFAULT);\n");
          }
          // 79, 22
          else
          {
            // 79, 29
            jamonWriter.write("      s::");
            // 80, 10
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 80, 43
            jamonWriter.write(" = ");
            // 80, 46
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 80, 65
            jamonWriter.write("_DEFAULT;\n");
          }
        }
        // 82, 18
        else if (reg.getNumEntries1() == 1 )
        {
          // 82, 55
          jamonWriter.write("      <i:");
          // 83, 10
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
          // 83, 29
          jamonWriter.write("_ENTRIES:(\n");
          // 84, 22
          if (reg.isStructure() )
          {
            // 84, 47
            jamonWriter.write("         unpack(s::");
            // 85, 20
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 85, 53
            jamonWriter.write("[i], ");
            // 85, 58
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 85, 77
            jamonWriter.write("_DEFAULT");
            // 85, 85
            if (reg.getNumDefaults() > 1 )
            {
              // 85, 117
              jamonWriter.write("[i]");
            }
            // 85, 126
            jamonWriter.write("); )>;\n");
          }
          // 86, 22
          else
          {
            // 86, 29
            jamonWriter.write("         s::");
            // 87, 13
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 87, 46
            jamonWriter.write("[i] = ");
            // 87, 52
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 87, 71
            jamonWriter.write("_DEFAULT");
            // 87, 79
            if (reg.getNumDefaults() > 1 )
            {
              // 87, 111
              jamonWriter.write("[i]");
            }
            // 87, 120
            jamonWriter.write("; )>;\n");
          }
        }
        // 89, 18
        else if (reg.getNumEntries2() == 1 )
        {
          // 89, 55
          jamonWriter.write("      <i0:");
          // 90, 11
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
          // 90, 30
          jamonWriter.write("_ENTRIES_0:(\n      <i1:");
          // 91, 11
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
          // 91, 30
          jamonWriter.write("_ENTRIES_1:(\n");
          // 92, 22
          if (reg.isStructure() )
          {
            // 92, 47
            jamonWriter.write("          unpack(s::");
            // 93, 21
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 93, 54
            jamonWriter.write("[i1,i0], ");
            // 93, 63
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 93, 82
            jamonWriter.write("_DEFAULT); )> )>;\n");
          }
          // 94, 22
          else
          {
            // 94, 29
            jamonWriter.write("          s::");
            // 95, 14
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 95, 47
            jamonWriter.write("[i1,i0] = ");
            // 95, 57
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 95, 76
            jamonWriter.write("_DEFAULT; )> )>;\n");
          }
        }
        // 97, 18
        else
        {
          // 97, 25
          jamonWriter.write("      <i2:");
          // 98, 11
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
          // 98, 30
          jamonWriter.write("_ENTRIES_2:(\n      <i0:");
          // 99, 11
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
          // 99, 30
          jamonWriter.write("_ENTRIES_0:(\n      <i1:");
          // 100, 11
          org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
          // 100, 30
          jamonWriter.write("_ENTRIES_1:(\n");
          // 101, 22
          if (reg.isStructure() )
          {
            // 101, 47
            jamonWriter.write("          unpack(s::");
            // 102, 21
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 102, 54
            jamonWriter.write("[i2,i1,i0], ");
            // 102, 66
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 102, 85
            jamonWriter.write("_DEFAULT); )> )> )>;\n");
          }
          // 103, 22
          else
          {
            // 103, 29
            jamonWriter.write("          s::");
            // 104, 14
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName().toLowerCase()), jamonWriter);
            // 104, 47
            jamonWriter.write("[i2,i1,i0] = ");
            // 104, 60
            org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(reg.getName()), jamonWriter);
            // 104, 79
            jamonWriter.write("_DEFAULT; )> )> )>;\n");
          }
        }
      }
    }
  }
  
  
  /**
   * @param jamonWriter
   * @throws java.io.IOException
   */
  // 29, 1
  protected void __jamon_innerUnit__registerStructureBase(final java.io.Writer jamonWriter, final Collection<Register> registers, final String camelCaseBaseName)
    throws java.io.IOException
  {
    // 33, 9
    jamonWriter.write("    structure ");
    // 34, 15
    org.jamon.escaping.Escaping.HTML.write(org.jamon.emit.StandardEmitter.valueOf(camelCaseBaseName), jamonWriter);
    // 34, 38
    jamonWriter.write("Registers = (\n");
    // 35, 14
    for (Register reg : registers )
    {
      // 35, 47
      if (reg.getAlias() == null )
      {
        // 36, 1
        {
          // 36, 1
          __jamon_innerUnit__registerStructureBaseReg(jamonWriter, reg , __jamon__get_Method_Opt_namePrefix_default());
        }
        // 37, 18
        if (reg.isShadow() )
        {
          // 38, 1
          {
            // 38, 1
            __jamon_innerUnit__registerStructureBaseReg(jamonWriter, reg, "SHADOW_" );
          }
        }
      }
    }
  }
  
  
  /**
   * @param jamonWriter
   * @throws java.io.IOException
   */
  // 60, 1
  protected void __jamon_innerUnit__registerInit(final java.io.Writer jamonWriter, final Collection<Register> registers, final String camelCaseBaseName)
    throws java.io.IOException
  {
    // 65, 1
    {
      // 65, 1
      __jamon_innerUnit__registerInitBase(jamonWriter, registers, camelCaseBaseName );
    }
    // 65, 81
    jamonWriter.write("\n    );\n");
  }
  
  
  /**
   * @param jamonWriter
   * @throws java.io.IOException
   */
  // 20, 1
  protected void __jamon_innerUnit__registerStructure(final java.io.Writer jamonWriter, final Collection<Register> registers, final String camelCaseBaseName)
    throws java.io.IOException
  {
    // 25, 1
    {
      // 25, 1
      __jamon_innerUnit__registerStructureBase(jamonWriter, registers, camelCaseBaseName );
    }
    // 25, 86
    jamonWriter.write("\n    );\n");
  }
  
  
  /**
   * @param jamonWriter
   * @throws java.io.IOException
   */
  // 110, 1
  protected void __jamon_innerUnit__registerAddressGuard(final java.io.Writer jamonWriter, final Register reg)
    throws java.io.IOException
  {
    // 114, 1
    {
      // 114, 1
      __jamon_innerUnit__registerAddressGuardExpr(jamonWriter, reg);
    }
    // 114, 41
    jamonWriter.write(" -> ");
  }
  
  
}
